<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能驾驶学习笔记 | 车道线检测</title>
    <meta name="description" content="by Lingfeng Ai">
    <link rel="icon" href="/udacity-self-driving-car-notes/logo.png">
  <link rel="manifest" href="/udacity-self-driving-car-notes/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/udacity-self-driving-car-notes/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/udacity-self-driving-car-notes/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/udacity-self-driving-car-notes/assets/css/40.styles.8bccc68c.css" as="style"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/app.f862d195.js" as="script"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/10.6dceeebb.js" as="script"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/0.a91770da.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/1.bf802ebd.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/2.9fcb0b63.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/3.04252e9b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/4.58f7cc53.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/5.fbc900e9.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/6.eb545374.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/7.9389e4d4.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/8.ca6e42ad.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/9.951d4fff.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/11.8b31e96d.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/12.47bd8573.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/13.01fa8388.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/14.5145a23d.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/15.a6c9c7ea.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/16.c8a59787.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/17.ef253f55.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/18.60236610.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/19.21a7c6ad.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/20.631b7e3b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/21.4ea4e658.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/22.24b95f64.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/23.20d37bd2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/24.16e76604.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/25.ded15832.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/26.698b1477.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/27.dd2fff6b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/28.60a3bb90.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/29.32a5d2dc.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/30.e686195c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/31.182bda29.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/32.72fbf8ad.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/33.1b4a0149.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/34.12748df4.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/35.4a1138f6.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/36.9e421a98.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/37.803fd82e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/38.0a53c283.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/39.aab83370.js">
    <link rel="stylesheet" href="/udacity-self-driving-car-notes/assets/css/40.styles.8bccc68c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/udacity-self-driving-car-notes/" class="home-link router-link-active"><!----><span class="site-name">
      智能驾驶学习笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>1. 计算机视觉基础</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html" class="active sidebar-link">车道线检测</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_1-车道线检测小程序" class="sidebar-link">1.车道线检测小程序</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_2-相关库函数" class="sidebar-link">2.相关库函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_1-numpy相关函数" class="sidebar-link">1. numpy相关函数</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_2-matplotlib相关函数" class="sidebar-link">2. matplotlib相关函数</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_3-opencv相关函数" class="sidebar-link">3. opencv相关函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_3-图像矩阵及mask" class="sidebar-link">3.图像矩阵及mask</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_4-霍夫变换" class="sidebar-link">4. 霍夫变换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_1-霍夫变换" class="sidebar-link">1.霍夫变换</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html#_5-边缘检测之canny" class="sidebar-link">5. 边缘检测之Canny</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2. 计算机视觉进阶</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>3. 深度学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>4. tersorflow</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>5. 卷积神经网络</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>6. 基于LeNet的信号灯分类</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>7. Keras</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>8. 迁移学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>9. 卡尔曼滤波</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="计算机视觉基础"><a href="#计算机视觉基础" aria-hidden="true" class="header-anchor">#</a> 计算机视觉基础</h1><h2 id="_1-车道线检测小程序"><a href="#_1-车道线检测小程序" aria-hidden="true" class="header-anchor">#</a> 1.车道线检测小程序</h2><ol><li>利用颜色进行检测</li><li>创建分割区域</li><li>边缘检测</li><li>直线提取</li></ol><p>综合以上技术，尤其是2，3，4，我们可以对一些比较规则的图片进行检测，得到一个比较不错的车道线检测效果</p><pre class="language-python"><code><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>image <span class="token keyword">as</span> mpimg
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2
fig_size <span class="token operator">=</span> <span class="token number">25</span>
COL <span class="token operator">=</span> <span class="token number">2</span>
<span class="token comment">#绘图</span>
<span class="token keyword">def</span> <span class="token function">draw_imgs</span><span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span>fig_size<span class="token punctuation">,</span>fig_size<span class="token punctuation">)</span><span class="token punctuation">,</span>dpi<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> index<span class="token punctuation">,</span>img <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>imgs<span class="token punctuation">)</span><span class="token operator">/</span>COL<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> COL<span class="token punctuation">,</span> index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment">#plt.imshow(img)</span>
        plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        fig<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#子图紧凑排版</span>
        
<span class="token comment">#在每张图上绘制多边形</span>
<span class="token keyword">def</span> <span class="token function">draw_poly</span><span class="token punctuation">(</span>vertices<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> vertices<span class="token punctuation">:</span>
        <span class="token keyword">for</span> xx<span class="token punctuation">,</span>yy <span class="token keyword">in</span> v<span class="token punctuation">:</span>
            x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>xx<span class="token punctuation">)</span>
            y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>yy<span class="token punctuation">)</span>
    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token string">'b--'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
imgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment"># Read in and grayscale the image</span>
image <span class="token operator">=</span> mpimg<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'exit.jpg'</span><span class="token punctuation">)</span>
gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>image<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_RGB2GRAY<span class="token punctuation">)</span>

<span class="token comment"># Define a kernel size and apply Gaussian smoothing</span>
<span class="token comment">###### 高斯模糊 #######</span>
kernel_size <span class="token operator">=</span> <span class="token number">5</span>
blur_gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token punctuation">(</span>kernel_size<span class="token punctuation">,</span> kernel_size<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># Define our parameters for Canny and apply</span>
<span class="token comment">###### canny 边缘检测 #######</span>
low_threshold <span class="token operator">=</span> <span class="token number">50</span>
high_threshold <span class="token operator">=</span> <span class="token number">150</span>
edges <span class="token operator">=</span> cv2<span class="token punctuation">.</span>Canny<span class="token punctuation">(</span>blur_gray<span class="token punctuation">,</span> low_threshold<span class="token punctuation">,</span> high_threshold<span class="token punctuation">)</span>

<span class="token comment"># Next we'll create a masked edges image using cv2.fillPoly()</span>
<span class="token comment"># 使用zeros_like构造一个和edges一样规模的零矩阵</span>
mask <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>edges<span class="token punctuation">)</span>   
ignore_mask_color <span class="token operator">=</span> <span class="token number">255</span>   

<span class="token comment"># This time we are defining a four sided polygon to mask</span>
<span class="token comment">###### 构建多边形区域 #######</span>
imshape <span class="token operator">=</span> image<span class="token punctuation">.</span>shape
vertices <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">450</span><span class="token punctuation">,</span> <span class="token number">290</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">490</span><span class="token punctuation">,</span> <span class="token number">290</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>imshape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>imshape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span>fillPoly<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> vertices<span class="token punctuation">,</span> ignore_mask_color<span class="token punctuation">)</span>
masked_edges <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>edges<span class="token punctuation">,</span> mask<span class="token punctuation">)</span>


<span class="token comment">###### 霍夫变换检测直线段 #######</span>
<span class="token comment"># Define the Hough transform parameters</span>
<span class="token comment"># Make a blank the same size as our image to draw on</span>
rho <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># distance resolution in pixels of the Hough grid</span>
theta <span class="token operator">=</span> np<span class="token punctuation">.</span>pi<span class="token operator">/</span><span class="token number">180</span> <span class="token comment"># angular resolution in radians of the Hough grid</span>
threshold <span class="token operator">=</span> <span class="token number">1</span>     <span class="token comment"># minimum number of votes (intersections in Hough grid cell)</span>
min_line_length <span class="token operator">=</span> <span class="token number">5</span> <span class="token comment">#minimum number of pixels making up a line</span>
max_line_gap <span class="token operator">=</span> <span class="token number">1</span>    <span class="token comment"># maximum gap in pixels between connectable line segments</span>
line_image <span class="token operator">=</span> np<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0</span> <span class="token comment"># creating a blank to draw lines on</span>

<span class="token comment"># Run Hough on edge detected image</span>
<span class="token comment"># Output &quot;lines&quot; is an array containing endpoints of detected line segments</span>
<span class="token comment"># 返回值是得到的霍夫变换检测到的符合条件的线段</span>
lines <span class="token operator">=</span> cv2<span class="token punctuation">.</span>HoughLinesP<span class="token punctuation">(</span>masked_edges<span class="token punctuation">,</span> rho<span class="token punctuation">,</span> theta<span class="token punctuation">,</span> threshold<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            min_line_length<span class="token punctuation">,</span> max_line_gap<span class="token punctuation">)</span>



<span class="token comment"># Iterate over the output &quot;lines&quot; and draw lines on a blank image</span>
<span class="token comment">###### 给检测到到线段着色并绘制在图像上 #######</span>
<span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
    <span class="token keyword">for</span> x1<span class="token punctuation">,</span>y1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y2 <span class="token keyword">in</span> line<span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>line<span class="token punctuation">(</span>line_image<span class="token punctuation">,</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span>y1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span>y2<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span>

<span class="token comment"># Create a &quot;color&quot; binary image to combine with line image</span>
color_edges <span class="token operator">=</span> np<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">(</span>edges<span class="token punctuation">,</span> edges<span class="token punctuation">,</span> edges<span class="token punctuation">)</span><span class="token punctuation">)</span> 

<span class="token comment"># Draw the lines on the edge image</span>
lines_edges <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>color_edges<span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> line_image<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> 

imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;origin&quot;</span><span class="token punctuation">:</span>image<span class="token punctuation">}</span><span class="token punctuation">)</span>
imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;blur_gray&quot;</span><span class="token punctuation">:</span>blur_gray<span class="token punctuation">}</span><span class="token punctuation">)</span>
imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;edges&quot;</span><span class="token punctuation">:</span>edges<span class="token punctuation">}</span><span class="token punctuation">)</span>
imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;mask&quot;</span><span class="token punctuation">:</span>mask<span class="token punctuation">}</span><span class="token punctuation">)</span>
imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;masked_edges&quot;</span><span class="token punctuation">:</span>masked_edges<span class="token punctuation">}</span><span class="token punctuation">)</span>
imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;line_image&quot;</span><span class="token punctuation">:</span>line_image<span class="token punctuation">}</span>

draw_imgs<span class="token punctuation">(</span>imgs<span class="token punctuation">,</span>vertices<span class="token punctuation">)</span>

</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/15339110799849.5b24a1a3.jpg" alt></p><h2 id="_2-相关库函数"><a href="#_2-相关库函数" aria-hidden="true" class="header-anchor">#</a> 2.相关库函数</h2><h3 id="_1-numpy相关函数"><a href="#_1-numpy相关函数" aria-hidden="true" class="header-anchor">#</a> 1. numpy相关函数</h3><table><thead><tr><th style="text-align:center">功能</th><th style="text-align:center">函数</th><th style="text-align:center">使用</th></tr></thead><tbody><tr><td style="text-align:center">多边形拟合</td><td style="text-align:center"><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.polyfit.html" target="_blank" rel="noopener noreferrer">numpy.polyfit</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">深度方向叠加矩阵</td><td style="text-align:center"><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.dstack.html" target="_blank" rel="noopener noreferrer">numpy.dstack</a></td><td style="text-align:center"></td></tr></tbody></table><h3 id="_2-matplotlib相关函数"><a href="#_2-matplotlib相关函数" aria-hidden="true" class="header-anchor">#</a> 2. matplotlib相关函数</h3><table><thead><tr><th style="text-align:center">功能</th><th style="text-align:center">函数</th><th style="text-align:center">使用</th></tr></thead><tbody><tr><td style="text-align:center">绘制子图</td><td style="text-align:center"><a href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.subplot.html#matplotlib.pyplot.subplot" target="_blank" rel="noopener noreferrer">matplotlib.pyplot..subplot</a></td><td style="text-align:center"><code>subplot(nrows, ncols, index, **kwargs)</code></td></tr></tbody></table><pre class="language-python"><code>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span>fig_size<span class="token punctuation">,</span>fig_size<span class="token punctuation">)</span><span class="token punctuation">,</span>dpi<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 一共绘制1行2列子图，这个是第1个</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment"># 一共绘制1行2列子图，这个是第2个</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/15338267691227.6c5d7d14.jpg" alt></p><p>https://blog.csdn.net/yuejisuo1948/article/details/81023125</p><h3 id="_3-opencv相关函数"><a href="#_3-opencv相关函数" aria-hidden="true" class="header-anchor">#</a> 3. opencv相关函数</h3><table><thead><tr><th style="text-align:center">功能</th><th style="text-align:center">函数</th><th style="text-align:center">用法</th></tr></thead><tbody><tr><td style="text-align:center">绘制线条</td><td style="text-align:center"><a href="https://docs.opencv.org/3.0-beta/modules/imgproc/doc/drawing_functions.html?highlight=line#cv2.line" target="_blank" rel="noopener noreferrer">cv2.line</a></td><td style="text-align:center"><code>cv2.line(img, pt1, pt2, color[, thickness[, lineType[, shift]]]) → img</code></td></tr><tr><td style="text-align:center">绘制多边形</td><td style="text-align:center"><a href="https://docs.opencv.org/3.0-beta/modules/imgproc/doc/drawing_functions.html?highlight=cv2.fillpoly#cv2.fillPoly" target="_blank" rel="noopener noreferrer">cv2.fillPoly</a></td><td style="text-align:center"><code>cv2.fillPoly(img, pts, color[, lineType[, shift[, offset]]]) → img</code></td></tr><tr><td style="text-align:center">按位与，即应用一个mask到目标图像</td><td style="text-align:center"><a href="https://docs.opencv.org/3.0-beta/modules/core/doc/operations_on_arrays.html?highlight=bitwise_and#cv2.bitwise_and" target="_blank" rel="noopener noreferrer">cv2.bitwise_and</a></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">霍夫直线检测</td><td style="text-align:center"><a href="https://docs.opencv.org/3.0-beta/modules/imgproc/doc/feature_detection.html?highlight=cv2.houghlinesp#cv2.HoughLinesP" target="_blank" rel="noopener noreferrer">cv2.HoughLinesP</a></td><td style="text-align:center"></td></tr></tbody></table><p>cv2.inRange() for color selection
cv2.fillPoly() for regions selection
cv2.line() to draw lines on an image given endpoints
cv2.addWeighted() to coadd / overlay two images cv2.cvtColor() to grayscale or change color cv2.imwrite() to output images to file
cv2.bitwise_and() to apply a mask to an image</p><p>图片缩放</p><pre class="language-text"><code>def save_image(filename,img):
    size = img.shape
    print(size)
    img2save = cv2.resize(img,(size[1]//2,size[0]//2),cv2.INTER_LINEAR)
    print(img2save.shape)
    plt.imsave(&quot;./examples/{0}.jpg&quot;.format(filename),img2save)
</code></pre><p>plot转换为图片</p><p>子图</p><pre class="language-python"><code>
<span class="token keyword">def</span> <span class="token function">draw_poly</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>img<span class="token punctuation">,</span>vertices<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> vertices<span class="token punctuation">:</span>
        <span class="token keyword">for</span> xx<span class="token punctuation">,</span>yy <span class="token keyword">in</span> v<span class="token punctuation">:</span>
            x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>xx<span class="token punctuation">)</span>
            y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>yy<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">,</span>markersize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
            note_point <span class="token operator">=</span> <span class="token string">&quot;({0},{1})&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>note_point<span class="token punctuation">,</span>xy<span class="token operator">=</span><span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">)</span><span class="token punctuation">,</span>color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
            
    x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token string">'b--'</span><span class="token punctuation">,</span> lw<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    <span class="token comment">#print(help(poly_img))</span>
    fig<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">&quot;./examples/{0}.jpg&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#ax = plt.gca()</span>
    <span class="token comment">#ax.invert_yaxis() </span>
</code></pre><pre class="language-text"><code>f, ((ax1, ax2) ,(ax3,ax4)) = plt.subplots(2, 2, figsize=(24, 9))
f.tight_layout()
ax1.imshow(image)
ax1.set_title('Original Image', fontsize=50)
ax3.imshow(grad_binary_x, cmap='gray')
ax3.set_title('Thresholded Gradient', fontsize=50)
plt.subplots_adjust(left=0., right=1, top=1.5, bottom=0.)
ax4.imshow(grad_binary_y, cmap='gray')
ax4.set_title('Thresholded Gradient', fontsize=50)
plt.subplots_adjust(left=0., right=1, top=1.5, bottom=0.)
</code></pre><p>dpi</p><h2 id="_3-图像矩阵及mask"><a href="#_3-图像矩阵及mask" aria-hidden="true" class="header-anchor">#</a> 3.图像矩阵及mask</h2><h2 id="_4-霍夫变换"><a href="#_4-霍夫变换" aria-hidden="true" class="header-anchor">#</a> 4. 霍夫变换</h2><h3 id="_1-霍夫变换"><a href="#_1-霍夫变换" aria-hidden="true" class="header-anchor">#</a> 1.霍夫变换</h3><p>阅读材料2是一个非常好的了解霍夫变换的资料。在此做一些总结。</p><h4 id="_1-斜率-截距空间"><a href="#_1-斜率-截距空间" aria-hidden="true" class="header-anchor">#</a> 1. 斜率-截距空间</h4><p>首先，我们在图像空间中，找到两个端点 (𝑥1,𝑦1) 和 (𝑥2,𝑦2)，它们是可以构成一条直线的，但是我们先不去管通过它们的直线，但看每一个点，都有无限个直线，以不同的斜率m和截距b，通过这个点。</p><p><img src="/udacity-self-driving-car-notes/assets/img/15338211284672.3da117c4.jpg" alt></p><p>我们把y=mx+b变换成b=y-mx之后，实际上可以将这某个直线变换到一个以b和m做参数的空间中，此时，图像空间中的一条固定直线，因其b和m是定值，所以在m-b空间中是一个点(m,b)。
类似的，图像空间中的某个点(𝑥1,𝑦1) ，因其b和m符合b=y-mx方程，因此在m-b空间中是一条直线。</p><p>这时我们再看之前穿过 (𝑥1,𝑦1) 和 (𝑥2,𝑦2)的直线，这条直线上的所有的点，其斜率和截距都是m和b，因此这个直线上的所有的点，在m-b空间中都经过点(m,b)。</p><p>每当我们找到端点为 (𝑥1,𝑦1) 和 (𝑥2,𝑦2)的一条直线上的点，mb空间中的点(m,b)就会被一条直线经过，这个过程称为<strong>vote</strong>，因此，vote越多，说明我们在 (𝑥1,𝑦1) 和 (𝑥2,𝑦2)上找到的线段越多，越可能是直线。</p><h4 id="_2-极坐标空间"><a href="#_2-极坐标空间" aria-hidden="true" class="header-anchor">#</a> 2. 极坐标空间</h4><p>上述m-b空间最大的问题是，截距可能会是无穷，这样在m-b空间上就找不到点(m,b)了。
因此引入极坐标空间。
<img src="/udacity-self-driving-car-notes/assets/img/15338221454689.aa2b13fa.jpg" alt></p><pre class="language-text"><code>ρ = x cos θ + y sin θ

where:
ρ (rho) = distance from origin to the line. [-max_dist to max_dist].
          max_dist is the diagonal length of the image.  
θ = angle from origin to the line. [-90° to 90°]
</code></pre><p>变换到霍夫空间中的时候，原图像中的点，变换为曲线，原图像中的直线，变换为点。因此两条曲线的焦点就表示找到了过这两个点的一条直线。
<img src="/udacity-self-driving-car-notes/assets/img/15338223834947.a3085e41.jpg" alt></p><p>同样，越多的直线经过这两点，霍夫空间中的曲线焦点被相交的次数越多，vote次数也越多。</p><p>我们在实际的运用中，可以设定一个阈值，相交点被vote的次数为5，也就是说，在图像空间两个端点 (𝑥1,𝑦1) 和 (𝑥2,𝑦2)，连成的直线上，我们至少还能找到其他5个点组成的线段。</p><pre><code>rho = 1 # distance resolution in pixels of the Hough grid
theta = np.pi/180 # angular resolution in radians of the Hough grid
threshold = 100   #这个值越大，被检测到的直线段越少，有可能检测不到 
min_line_len = 50 #minimum number of pixels making up a line
max_line_gap = 100    # maximum gap in pixels between connectable line segments
line_img,lines = hough_lines(masked_edges, rho, theta, threshold, min_line_len, max_line_gap)
</code></pre><div class="warning custom-block"><p class="custom-block-title">TODO</p><p>绘图描述</p></div><div class="tip custom-block"><p class="custom-block-title">阅读材料</p><ol><li><a href="https://www.cnblogs.com/cheermyang/p/5348820.html" target="_blank" rel="noopener noreferrer">霍夫变换--直线检测--扫描软件如何检测纸张边缘</a></li><li><a href="https://alyssaq.github.io/2014/understanding-hough-transform/" target="_blank" rel="noopener noreferrer">Understanding Hough Transform With Python</a></li></ol></div><h2 id="_5-边缘检测之canny"><a href="#_5-边缘检测之canny" aria-hidden="true" class="header-anchor">#</a> 5. 边缘检测之Canny</h2><p>https://blog.csdn.net/wishchin/article/details/50969322</p><div class="tip custom-block"><p class="custom-block-title">阅读材料</p><ol><li><a href="https://www.cnblogs.com/techyan1990/p/7291771.html" target="_blank" rel="noopener noreferrer">边缘检测之Canny</a></li></ol></div><hr><div class="tip custom-block"><p class="custom-block-title">扩展阅读</p><ol><li><a href="https://selfdrivingcars.mit.edu/" target="_blank" rel="noopener noreferrer">MIT 无人车课程</a></li><li><a href="https://baike.baidu.com/item/Apex/10532507?fr=aladdin" target="_blank" rel="noopener noreferrer">apex过弯中心点</a></li><li><a href="https://cn.udacity.com/course/introduction-to-computer-vision--ud810" target="_blank" rel="noopener noreferrer">计算机视觉概论</a></li></ol></div></div><div class="content edit-link"><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/edit/master/package/posts/self-driving-car/find-lane-line.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><!----><span class="next"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/camera.html">
          相机标定
        </a> →
      </span></p></div></div></div></div>
    <script src="/udacity-self-driving-car-notes/assets/js/10.6dceeebb.js" defer></script><script src="/udacity-self-driving-car-notes/assets/js/app.f862d195.js" defer></script>
  </body>
</html>
