<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能驾驶学习笔记 | 视角变换</title>
    <meta name="description" content="by Lingfeng Ai">
    <link rel="icon" href="/udacity-self-driving-car-notes/logo.png">
  <link rel="manifest" href="/udacity-self-driving-car-notes/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/udacity-self-driving-car-notes/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/udacity-self-driving-car-notes/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/udacity-self-driving-car-notes/assets/css/35.styles.5c875455.css" as="style"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/app.adcd6e18.js" as="script"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/2.997285ba.js" as="script"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/0.928987af.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/1.af6be042.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/3.5d010771.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/4.b24f24bb.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/5.51bbd3c0.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/6.b8471489.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/7.08371cf4.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/8.72cff05c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/9.ff02842e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/10.45937176.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/11.22a9de93.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/12.992b98d1.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/13.e2e7ee02.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/14.23a306a2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/15.54054ca0.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/16.560b4f9a.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/17.2a7b59a8.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/18.bb3cfe6b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/19.6178034f.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/20.07f5c0cf.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/21.230ba7e5.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/22.11df9430.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/23.2450de7b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/24.b2d559fd.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/25.abb9c08e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/26.6864309f.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/27.d772ed58.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/28.1be3b4bf.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/29.e80e6a50.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/30.aa9f0165.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/31.defb0963.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/32.15035b78.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/33.70438b13.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/34.25bb1e1d.js">
    <link rel="stylesheet" href="/udacity-self-driving-car-notes/assets/css/35.styles.5c875455.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/udacity-self-driving-car-notes/" class="home-link router-link-active"><!----><span class="site-name">
      智能驾驶学习笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>1. 计算机视觉基础</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>2. 计算机视觉进阶</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/camera.html" class="sidebar-link">相机标定</a></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/colorspace.html" class="sidebar-link">梯度和色彩空间</a></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/perspective.html" class="active sidebar-link">视角变换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/perspective.html#视角变换" class="sidebar-link">视角变换</a></li></ul></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html" class="sidebar-link">项目2——高级车道线检测</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>3. 深度学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>4. tersorflow</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>5.卷积神经网络</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>6.基于LeNet的信号灯分类</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h2 id="视角变换"><a href="#视角变换" aria-hidden="true" class="header-anchor">#</a> 视角变换</h2><p><img src="/udacity-self-driving-car-notes/assets/img/15352497500983.756145c6.jpg" alt></p><p><img src="/udacity-self-driving-car-notes/assets/img/15352499212136.ed843223.jpg" alt></p><p>变换的方法和正畸算法类似，但是正畸算法是将标准对象点变换到图像上，而透视变换是将一种视角的图像上的兴趣点，变换到目标视角图像上。通过这种变换我们可以更好的从图片中获取我们关注的信息。</p><p><img src="/udacity-self-driving-car-notes/assets/img/15352501469628.277cb7ab.jpg" alt></p><p>进行线性变换，我们只需要在两张图片中各选取四个点，分别构建一个平面，然后计算变换矩阵，进行变换。</p><p>注意：有很多自动选点算法，比如利用边缘和端点等</p><ol><li>基于源和目的图像的四个点，计算变换矩阵M</li></ol><pre class="language-text"><code>M = cv2.getPerspectiveTransform(src, dst)
</code></pre><ol start="2"><li>计算逆矩阵(用于恢复)</li></ol><pre class="language-text"><code>Minv = cv2.getPerspectiveTransform(dst, src)
</code></pre><ol><li>变换视角</li></ol><pre class="language-text"><code>warped = cv2.warpPerspective(img, M, img_size, flags=cv2.INTER_LINEAR)
</code></pre><pre class="language-python"><code>_img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;./calibration_wide/dst.jpg&quot;</span><span class="token punctuation">)</span>

nx <span class="token operator">=</span> <span class="token number">8</span> <span class="token comment"># the number of inside corners in x</span>
ny <span class="token operator">=</span> <span class="token number">6</span> <span class="token comment"># the number of inside corners in y</span>


<span class="token keyword">def</span> <span class="token function">draw_poly</span><span class="token punctuation">(</span>points<span class="token punctuation">,</span>p_color<span class="token punctuation">,</span>l_color<span class="token punctuation">,</span>text_color<span class="token punctuation">,</span>ax<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    xx <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    yy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> index<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token keyword">in</span> v<span class="token punctuation">:</span>
            <span class="token keyword">if</span> ax<span class="token punctuation">:</span>
                ax<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span><span class="token string">&quot;  p{0}({1},{2})&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span>fontsize<span class="token punctuation">,</span>color<span class="token operator">=</span>text_color<span class="token punctuation">)</span>
                ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>p_color<span class="token punctuation">,</span>markersize<span class="token operator">=</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                plt<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span><span class="token string">&quot;  p{0}({1},{2})&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span>fontsize<span class="token punctuation">,</span>color<span class="token operator">=</span>text_color<span class="token punctuation">)</span>
                plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>p_color<span class="token punctuation">,</span>markersize<span class="token operator">=</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">)</span>
            xx<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            yy<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    
    xx<span class="token punctuation">.</span>append<span class="token punctuation">(</span>xx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    yy<span class="token punctuation">.</span>append<span class="token punctuation">(</span>yy<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ax<span class="token punctuation">:</span>
        ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">,</span>l_color<span class="token punctuation">,</span>lw<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>xx<span class="token punctuation">,</span>yy<span class="token punctuation">,</span>l_color<span class="token punctuation">,</span>lw<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>


    
    
    
    
<span class="token keyword">def</span> <span class="token function">corners_unwarp</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Pass in your image into this function</span>
    <span class="token comment"># Write code to do the following steps</span>
    <span class="token comment"># 1) Undistort using mtx and dist</span>
    <span class="token comment"># 2) Convert to grayscale</span>
    <span class="token comment"># 3) Find the chessboard corners</span>
    <span class="token comment"># 4) If corners found: </span>
            <span class="token comment"># a) draw corners</span>
            <span class="token comment"># b) define 4 source points src = np.float32([[,],[,],[,],[,]])</span>
                 <span class="token comment">#Note: you could pick any four of the detected corners </span>
                 <span class="token comment"># as long as those four corners define a rectangle</span>
                 <span class="token comment">#One especially smart way to do this would be to use four well-chosen</span>
                 <span class="token comment"># corners that were automatically detected during the undistortion steps</span>
                 <span class="token comment">#We recommend using the automatic detection of corners in your code</span>
            <span class="token comment"># c) define 4 destination points dst = np.float32([[,],[,],[,],[,]])</span>
            <span class="token comment"># d) use cv2.getPerspectiveTransform() to get M, the transform matrix</span>
            <span class="token comment"># e) use cv2.warpPerspective() to warp your image to a top-down view</span>
    <span class="token comment">#delete the next two lines</span>
    _gray <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>_img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    ret<span class="token punctuation">,</span> corners <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findChessboardCorners<span class="token punctuation">(</span>_gray<span class="token punctuation">,</span> <span class="token punctuation">(</span>COL<span class="token punctuation">,</span>ROW<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
    <span class="token comment">#print(corners)</span>
    dst_with_corner <span class="token operator">=</span> cv2<span class="token punctuation">.</span>drawChessboardCorners<span class="token punctuation">(</span>_gray<span class="token punctuation">,</span><span class="token punctuation">(</span>COL<span class="token punctuation">,</span>ROW<span class="token punctuation">)</span><span class="token punctuation">,</span>corners<span class="token punctuation">,</span>ret<span class="token punctuation">)</span>
    
    src_point <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span>corners<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>corners<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>corners<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>corners<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>dst_with_corner<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span>
    draw_poly<span class="token punctuation">(</span>src_point<span class="token punctuation">,</span><span class="token string">&quot;.g&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;yellow&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">#print(src_point)</span>
    
    <span class="token comment">#offset = 100</span>
    <span class="token comment">#dst = np.float32([[offset, offset], [img_size[0]-offset, offset], [img_size[0]-offset, img_size[1]-offset], [offset, img_size[1]-offset]])</span>
    dst_point <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span><span class="token number">214</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">370</span><span class="token punctuation">,</span><span class="token number">214</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">370</span><span class="token punctuation">,</span><span class="token number">365</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">94</span><span class="token punctuation">,</span><span class="token number">365</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">#dst_point = np.float32([[corners[0][0]],[[corners[0][1][0],214]],[[370,365]],[[94,365]]])</span>
    <span class="token comment">#print(corners[0])</span>
    <span class="token comment">#print(dst_point)</span>
    draw_poly<span class="token punctuation">(</span>dst_point<span class="token punctuation">,</span><span class="token string">&quot;.r&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;--y&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">)</span>
    
    M <span class="token operator">=</span> cv2<span class="token punctuation">.</span>getPerspectiveTransform<span class="token punctuation">(</span>src_point<span class="token punctuation">,</span> dst_point<span class="token punctuation">)</span>
    warped <span class="token operator">=</span> cv2<span class="token punctuation">.</span>warpPerspective<span class="token punctuation">(</span>_gray<span class="token punctuation">,</span> M<span class="token punctuation">,</span> _gray<span class="token punctuation">.</span>shape<span class="token punctuation">,</span> flags<span class="token operator">=</span>cv2<span class="token punctuation">.</span>INTER_LINEAR<span class="token punctuation">)</span>
 
    <span class="token keyword">return</span> warped<span class="token punctuation">,</span> M<span class="token punctuation">,</span>src_point<span class="token punctuation">,</span>dst_point

top_down<span class="token punctuation">,</span> perspective_M<span class="token punctuation">,</span>src_point<span class="token punctuation">,</span>dst_point<span class="token operator">=</span> corners_unwarp<span class="token punctuation">(</span>_img<span class="token punctuation">,</span> nx<span class="token punctuation">,</span> ny<span class="token punctuation">)</span>
f<span class="token punctuation">,</span> <span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>

draw_poly<span class="token punctuation">(</span>src_point<span class="token punctuation">,</span><span class="token string">&quot;.g&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;yellow&quot;</span><span class="token punctuation">,</span>ax1<span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>_img<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span>
ax1<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>

draw_poly<span class="token punctuation">(</span>dst_point<span class="token punctuation">,</span><span class="token string">&quot;.r&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;--y&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;red&quot;</span><span class="token punctuation">,</span>ax2<span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>top_down<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Undistorted and Warped Image'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplots_adjust<span class="token punctuation">(</span>left<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> right<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> top<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">,</span> bottom<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/15354665136102.a7f49aa0.jpg" alt></p><p><img src="/udacity-self-driving-car-notes/assets/img/15357674415153.a8684064.jpg" alt></p><p>如果比例相差太大，会产生缩放的效果
<img src="/udacity-self-driving-car-notes/assets/img/15357675510199.08275d19.jpg" alt></p></div><div class="content edit-link"><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/edit/master/package/posts/self-driving-car/perspective.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/udacity-self-driving-car-notes/posts/self-driving-car/colorspace.html" class="prev">
          梯度和色彩空间
        </a></span><span class="next"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html">
          项目2——高级车道线检测
        </a> →
      </span></p></div></div></div></div>
    <script src="/udacity-self-driving-car-notes/assets/js/2.997285ba.js" defer></script><script src="/udacity-self-driving-car-notes/assets/js/app.adcd6e18.js" defer></script>
  </body>
</html>
