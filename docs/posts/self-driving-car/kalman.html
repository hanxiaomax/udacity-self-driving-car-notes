<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能驾驶学习笔记 | 卡尔曼滤波</title>
    <meta name="description" content="by Lingfeng Ai">
    <link rel="icon" href="/udacity-self-driving-car-notes/logo.png">
  <link rel="manifest" href="/udacity-self-driving-car-notes/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/udacity-self-driving-car-notes/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/udacity-self-driving-car-notes/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/udacity-self-driving-car-notes/assets/css/39.styles.324ff695.css" as="style"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/app.9d1536ba.js" as="script"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/8.d5dc0d43.js" as="script"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/0.5a0d0a03.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/1.3c16db86.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/2.82869c57.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/3.abce6f6e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/4.d292cf16.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/5.ea8d1b25.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/6.075c246a.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/7.b08b1660.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/9.5b0c06bc.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/10.0b8a6888.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/11.42ab3273.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/12.e2c4661c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/13.879fc8b7.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/14.d39d5a97.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/15.ac893474.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/16.66a78c36.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/17.d2854f61.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/18.2e384199.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/19.b2ee5ebf.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/20.07070574.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/21.843b60f6.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/22.41e82bd8.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/23.6923b46f.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/24.c0dac1ae.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/25.797e5ac2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/26.0d99f9e6.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/27.955632c7.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/28.77e6b09c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/29.4840cba9.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/30.4cceab91.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/31.2c3721c9.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/32.e332d881.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/33.d1f45cc8.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/34.a320b8af.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/35.d69a41d9.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/36.79745f71.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/37.e340c11e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/38.a581b2e6.js">
    <link rel="stylesheet" href="/udacity-self-driving-car-notes/assets/css/39.styles.324ff695.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/udacity-self-driving-car-notes/" class="home-link router-link-active"><!----><span class="site-name">
      智能驾驶学习笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>1. 计算机视觉基础</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2. 计算机视觉进阶</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>3. 深度学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>4. tersorflow</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>5. 卷积神经网络</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>6. 基于LeNet的信号灯分类</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>7. Keras</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>8. 迁移学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>9. 卡尔曼滤波</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html" class="active sidebar-link">卡尔曼滤波</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_1-更新循环和移动循环" class="sidebar-link">1. 更新循环和移动循环</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_2-测量更新" class="sidebar-link">2. 测量更新</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#数学原理" class="sidebar-link">数学原理</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#代码" class="sidebar-link">代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_3-移动更新（预测过程）" class="sidebar-link">3. 移动更新（预测过程）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#数学原理-2" class="sidebar-link">数学原理</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#代码-2" class="sidebar-link">代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_4-一维卡尔曼滤波代码" class="sidebar-link">4. 一维卡尔曼滤波代码</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_5-多维高斯分布" class="sidebar-link">5. 多维高斯分布</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_6-基于多维高斯函数的预测" class="sidebar-link">6. 基于多维高斯函数的预测</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_7-设计卡尔曼滤波器" class="sidebar-link">7. 设计卡尔曼滤波器</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#卡尔曼滤波详解" class="sidebar-link">卡尔曼滤波详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_1-卡尔曼滤波简介" class="sidebar-link">1. 卡尔曼滤波简介</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_2-流程图" class="sidebar-link">2. 流程图</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_3-卡尔曼增益" class="sidebar-link">3. 卡尔曼增益</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_4-卡尔曼滤波3大计算公式" class="sidebar-link">4. 卡尔曼滤波3大计算公式</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_5-计算样例" class="sidebar-link">5. 计算样例</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_6-多维卡尔曼滤波" class="sidebar-link">6. 多维卡尔曼滤波</a></li></ul></li></ul></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/extended_kalman.html" class="sidebar-link">扩展卡尔曼滤波器</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="卡尔曼滤波"><a href="#卡尔曼滤波" aria-hidden="true" class="header-anchor">#</a> 卡尔曼滤波</h1><h2 id="_1-更新循环和移动循环"><a href="#_1-更新循环和移动循环" aria-hidden="true" class="header-anchor">#</a> 1. 更新循环和移动循环</h2><ul><li>更新循环
基于乘法法则和贝叶斯定律</li><li>移动循环（预测）
基于卷积和全概率公式</li></ul><p><img src="/udacity-self-driving-car-notes/assets/img/15399554841338.52a159fb.jpg" alt></p><h2 id="_2-测量更新"><a href="#_2-测量更新" aria-hidden="true" class="header-anchor">#</a> 2. 测量更新</h2><h3 id="数学原理"><a href="#数学原理" aria-hidden="true" class="header-anchor">#</a> 数学原理</h3><p>测量的更新，基于乘法法则和贝叶斯定律。
首先我们有一个先验的测量值，然后得到一个新的测量值，两者均为正态分布。使用贝叶斯定律，我们可以得到后验概率，也就是我们更新测量后的结果</p><p><img src="/udacity-self-driving-car-notes/assets/img/15399561190760.62f938c1.jpg" alt></p><p>P(X|Z) = P(Z|X)P(X)/P(Z)
叠加之后的正态分布参数为
$
\mu^2=\frac{\mu* r^2 + \gamma*\sigma^2}{r^2+\sigma^2}
$</p><p>$
\sigma^2=\frac{1}{\frac{1}{r^2}+\frac{1}{\sigma^2}}
$</p><h3 id="代码"><a href="#代码" aria-hidden="true" class="header-anchor">#</a> 代码</h3><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> <span class="token punctuation">(</span>mean1<span class="token operator">*</span>var2<span class="token operator">+</span>mean2<span class="token operator">*</span>var1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>var1<span class="token operator">+</span>var2<span class="token punctuation">)</span>
    new_var <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>var1 <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">/</span>var2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>
</code></pre><h2 id="_3-移动更新（预测过程）"><a href="#_3-移动更新（预测过程）" aria-hidden="true" class="header-anchor">#</a> 3. 移动更新（预测过程）</h2><p><img src="/udacity-self-driving-car-notes/assets/img/15399574409127.8012fea9.jpg" alt>
预测过程基于卷积和全概率公式</p><h3 id="数学原理-2"><a href="#数学原理-2" aria-hidden="true" class="header-anchor">#</a> 数学原理</h3><p>假设我们处于一个初始位置，然后进行一次移动，移动本身是有误差的，两个事件都服从正态分布。则结果也是正态分布</p><p>$
\mu'=\mu + u
$</p><p>$
\sigma'^2 =r^2+\sigma^2
$</p><h3 id="代码-2"><a href="#代码-2" aria-hidden="true" class="header-anchor">#</a> 代码</h3><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> mean1<span class="token operator">+</span>mean2
    new_var <span class="token operator">=</span> var1<span class="token operator">+</span>var2
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>
</code></pre><h2 id="_4-一维卡尔曼滤波代码"><a href="#_4-一维卡尔曼滤波代码" aria-hidden="true" class="header-anchor">#</a> 4. 一维卡尔曼滤波代码</h2><pre class="language-python"><code><span class="token comment"># 更新函数</span>
<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>var2 <span class="token operator">*</span> mean1 <span class="token operator">+</span> var1 <span class="token operator">*</span> mean2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>var1 <span class="token operator">+</span> var2<span class="token punctuation">)</span>
    new_var <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span>var1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span>var2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>
<span class="token comment"># 预测函数</span>
<span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> mean1 <span class="token operator">+</span> mean2
    new_var <span class="token operator">=</span> var1 <span class="token operator">+</span> var2
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>

measurements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment"># 测量值</span>
motion <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment"># 移动距离</span>
measurement_sig <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment"># 测量方差</span>
motion_sig <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment"># 移动方差</span>
<span class="token comment"># 初始值</span>
mu <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>
sig <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">.</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>measurements<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token operator">=</span>update<span class="token punctuation">(</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">,</span>measurements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>measurement_sig<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;update:&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 使用更新的均值和方差进行预测</span>
    <span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token operator">=</span>predict<span class="token punctuation">(</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">,</span>motion<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>motion_sig<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;pridict:&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token punctuation">)</span>
    
<span class="token keyword">print</span> <span class="token punctuation">[</span>mu<span class="token punctuation">,</span> sig<span class="token punctuation">]</span>

</code></pre><pre class="language-text"><code>('update:', [4.998000799680128, 3.9984006397441023])
('pridict:', [5.998000799680128, 5.998400639744102])
('update:', [5.999200191953932, 2.399744061425258])
('pridict:', [6.999200191953932, 4.399744061425258])
('update:', [6.999619127420922, 2.0951800575117594])
('pridict:', [8.999619127420921, 4.09518005751176])
('update:', [8.999811802788143, 2.0235152416216957])
('pridict:', [9.999811802788143, 4.023515241621696])
('update:', [9.999906177177365, 2.0058615808441944])
('pridict:', [10.999906177177365, 4.005861580844194])
[10.999906177177365, 4.005861580844194]
</code></pre><h2 id="_5-多维高斯分布"><a href="#_5-多维高斯分布" aria-hidden="true" class="header-anchor">#</a> 5. 多维高斯分布</h2><p>在多维高斯函数中，均值变成了一个向量，方差变成了协方差矩阵。其概率密度如下：
<img src="/udacity-self-driving-car-notes/assets/img/15401319344883.00b2f007.jpg" alt></p><p>针对二维高斯分布，协方差矩阵的对角线元素为X1与X2轴的方差，反斜对角线上的两个值为协方差，表明X1与X2的线性相关程度，（正值时：X1增大，X2也随之增大；负值时：X1增大，X2随之减小）。</p><ul><li>如果两个变量无关，则协方差矩阵为一个圆</li><li>不确定越大，圆越大</li><li>也可能在一个方向上不确定大，另一个方向不确定小，则为椭圆</li><li>如果两个维度相关，则椭圆为斜的，所谓相关，指的是我们可以以一个维度推断另一个维度。通过(X0 ,Y0)，则可以推断(X1 ,Y1)</li></ul><p><img src="/udacity-self-driving-car-notes/assets/img/15401323707395.6fea8125.jpg" alt></p><h2 id="_6-基于多维高斯函数的预测"><a href="#_6-基于多维高斯函数的预测" aria-hidden="true" class="header-anchor">#</a> 6. 基于多维高斯函数的预测</h2><p>在平面上，基于一维的高斯，我们可以预测位置，同样的，在二维的空间中，我们也可以进行预测。</p><p><img src="/udacity-self-driving-car-notes/assets/img/15401333406014.a50f748c.jpg" alt></p><p>我们可以测量X，不能测量速度，但是速度是位置的导数，所以我们说两个维度是有相关性的。在测量过程中，我们可以测得X，此时我们对速度一无所知。在预测过程中，我们可以假设一个速度，这样就能知道X在此速度下，T+1时的位置X。</p><p><img src="/udacity-self-driving-car-notes/assets/img/15401347728831.8272337e.jpg" alt></p><p><strong>上图诠释了卡尔曼滤波的核心概念。</strong></p><p>首先我们知道了X和速度V（X导数）的关系，X = Vt，也就是红色的椭圆。但是显然，斜椭圆表示两者是相关的。但是如果我们将红色椭圆投影到X或X点方向上，我们都无法进行预测，因为不论投影在哪个轴，我们都缺少另一个变量的信息。即单次观察和单次预测都无法确定观察结果。</p><p>由于红色是我们已知的规律，所以它是一种<strong>先验概率（prior）</strong>，如果我们再对X进行一次观察，得到X的<strong>条件概率(measurement)</strong>，然后依据<a href="https://baike.baidu.com/item/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%85%AC%E5%BC%8F" target="_blank" rel="noopener noreferrer">贝叶斯定律</a>将两者相乘，我们就可以得到<strong>后验概率（预测）</strong>，后验概率一定相交于在红色椭圆上，它也是一个椭圆（二维高斯），且在两个维度上可以鸽子得到一个高斯函数，预测相关维度。经过不断的测量和预测，我们注意到，红色椭圆上的黑色椭圆越来越小，表示不确定性逐渐减小（方差减小了）</p><p>这深刻的揭示了卡尔曼滤波器的原理，我们只能观察一个值的时候，就可以利用贝叶斯推断另外一个值（通过先验知识——例如物理方程）</p><p>卡尔曼滤波器可以预测一段时间后我的位置，<code>x' = x + Δtẋ'</code>，且该方程在后续的预测中可以作为约束条件。利用该约束条件，我们就可以通过x来预测速度（本身不能观察）</p><h2 id="_7-设计卡尔曼滤波器"><a href="#_7-设计卡尔曼滤波器" aria-hidden="true" class="header-anchor">#</a> 7. 设计卡尔曼滤波器</h2><p><img src="/udacity-self-driving-car-notes/assets/img/15399619340700.f982be2b.jpg" alt></p><pre class="language-python"><code><span class="token comment"># Write a function 'kalman_filter' that implements a multi-</span>
<span class="token comment"># dimensional Kalman Filter for the example given</span>
<span class="token comment">########################################</span>
<span class="token comment"># Implement the filter function below</span>

<span class="token keyword">def</span> <span class="token function">kalman_filter</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>measurements<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># measurement update</span>
        Z <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>measurements<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 测量值</span>
        y <span class="token operator">=</span> Z <span class="token operator">-</span> <span class="token punctuation">(</span>H <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token comment"># </span>
        S <span class="token operator">=</span> H <span class="token operator">*</span> P <span class="token operator">*</span> H<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> R <span class="token comment">#</span>
        K <span class="token operator">=</span>  P <span class="token operator">*</span> H<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">*</span> S<span class="token punctuation">.</span>inverse<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span> K <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token comment">#</span>
        
        P <span class="token operator">=</span> <span class="token punctuation">(</span>I <span class="token operator">-</span><span class="token punctuation">(</span>K <span class="token operator">*</span> H<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> P <span class="token comment"># </span>
        
        <span class="token comment"># prediction</span>
        x <span class="token operator">=</span> <span class="token punctuation">(</span>F<span class="token operator">*</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> u
        P <span class="token operator">=</span> F <span class="token operator">*</span> P <span class="token operator">*</span> F<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span> 
        
    <span class="token keyword">return</span> x<span class="token punctuation">,</span>P

<span class="token comment">############################################</span>
<span class="token comment">### use the code below to test your filter!</span>
<span class="token comment">############################################</span>

measurements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

x <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># initial state (location and velocity)</span>
P <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># initial uncertainty</span>
u <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># external motion</span>
F <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># next state function</span>
H <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># measurement function</span>
R <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># measurement uncertainty</span>
I <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># identity matrix</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>kalman_filter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># output should be:</span>
<span class="token comment"># x: [[3.9996664447958645], [0.9999998335552873]]</span>
<span class="token comment"># P: [[2.3318904241194827, 0.9991676099921091], [0.9991676099921067, 0.49950058263974184]]</span>

</code></pre><h2 id="卡尔曼滤波详解"><a href="#卡尔曼滤波详解" aria-hidden="true" class="header-anchor">#</a> 卡尔曼滤波详解</h2><h3 id="_1-卡尔曼滤波简介"><a href="#_1-卡尔曼滤波简介" aria-hidden="true" class="header-anchor">#</a> 1. 卡尔曼滤波简介</h3><p><img src="/udacity-self-driving-car-notes/assets/img/15403080425699.d9cd8226.jpg" alt>
卡尔曼滤波器，可以从一组不断输入到系统的数据中，非常快速的推断出真实中（几乎），即使初始值偏差很大也没关系，卡尔曼滤波的收敛速度非常快。</p><h3 id="_2-流程图"><a href="#_2-流程图" aria-hidden="true" class="header-anchor">#</a> 2. 流程图</h3><p><img src="/udacity-self-driving-car-notes/assets/img/15403079997555.0271c02f.jpg" alt></p><ul><li>卡尔曼滤波器的流程如图所示，外部输入用红色表示，其中输入的数据data是不断加入系统的，而初始的估计误差和初始估计值，仅输入一次。</li><li>我们通过初始输入的误差，和数据误差，来计算卡尔曼增益。卡尔曼增益实际上就是考虑如何对输入的估计误差和数据误差进行加权，这取决于我们更信任哪个数据（误差越小越信任）</li><li>通过初始估计值和输入数据，计算新的估计值。</li><li>通过卡尔曼增益和新的估计值，计算新的误差。</li><li>将新的误差和作为输入，用于进行下一次卡尔曼增益的计算。</li><li>讲新的估计值作为更新数据，输出系统。</li></ul><h3 id="_3-卡尔曼增益"><a href="#_3-卡尔曼增益" aria-hidden="true" class="header-anchor">#</a> 3. 卡尔曼增益</h3><p><img src="/udacity-self-driving-car-notes/assets/img/15403084891943.d4bff2a8.jpg" alt></p><p>卡尔曼增益KG是一个0-1之间的小数，公式如上图。我们可以看到，KG越接近1，说明EMEA越小，反正说明EMEA越大。EMEA是测量误差，也就是测量误差越大，KG越小，测量误差越小，KG越大。</p><p>ESTt 即当前最新估计值，它等于上一次的估计值ESTt-1 + KG*[MEA-ESTt-1]</p><p>这么构造KG的原因是，我们把KG看作是一个权重，我们希望，测量误差大的时候，减少对测量值的信任权重。</p><p>所以，测量误差比较大时，KG*[MEA-ESTt-1]这部分的权重会小一些，使我们可以 减少测量值对估计值的影响。</p><p><img src="/udacity-self-driving-car-notes/assets/img/15403087035844.e187ebf6.jpg" alt></p><p>最终，卡尔曼增益要像越来越小的方向发展，既估计值误差越来越小，越来越不受测量值影响（趋于稳定）。</p><h3 id="_4-卡尔曼滤波3大计算公式"><a href="#_4-卡尔曼滤波3大计算公式" aria-hidden="true" class="header-anchor">#</a> 4. 卡尔曼滤波3大计算公式</h3><p><img src="/udacity-self-driving-car-notes/assets/img/15403108670060.5cb5083a.jpg" alt></p><p><img src="/udacity-self-driving-car-notes/assets/img/15403112725540.95ea43a5.jpg" alt></p><p>本节我们主要关注的是公式3，即如何计算最新的估计误差，估计误差可以化简成EESTt = (1-KG)EESTt-1的形式，观察该公式我们可以得到如下结论：</p><ul><li>最新的估计误差总是小于之前的估计误差，因为0&lt;(1-KG)&lt;1，误差是趋向于0的。</li><li>如果测量误差大，则KG小，系数1-KG就大，则估计误差收敛的速度也就比较慢。及测量误差大的时候，我们希望误差减小的速度慢一些，防止误判。</li><li>如果测量误差小，则KG大，系数1-KG就小，则估计误差收敛的速度也就比较快。及测量误差小的时候，我们希望误差减小的速度快一些</li></ul><h3 id="_5-计算样例"><a href="#_5-计算样例" aria-hidden="true" class="header-anchor">#</a> 5. 计算样例</h3><p><img src="/udacity-self-driving-car-notes/assets/img/15403123199237.2146e55a.jpg" alt></p><h3 id="_6-多维卡尔曼滤波"><a href="#_6-多维卡尔曼滤波" aria-hidden="true" class="header-anchor">#</a> 6. 多维卡尔曼滤波</h3><p><img src="/udacity-self-driving-car-notes/assets/img/15403124014269.bc4d0035.jpg" alt></p><ul><li>X状态矩阵</li><li>P处理协方差矩阵（估计误差）</li><li>K卡尔曼增益</li><li>k状态序列序号，0为初始值</li><li>R传感器误差协方差矩阵</li><li>Y测量值矩阵</li><li>Z测量噪声（不确定性）</li><li>Q 处理误差协方差矩阵</li><li>A，B，C ，H变换矩阵
<ul><li>A，B 状态变换矩阵（含某种内在的变化规律）</li><li>C，H 测量变换矩阵</li></ul></li></ul><p><img src="/udacity-self-driving-car-notes/assets/img/15399619340700.f982be2b.jpg" alt></p><p>结合课程中的表述来看，C，H是一个值，F是A，B的结合。u=w表示运动向量</p><p><img src="/udacity-self-driving-car-notes/assets/img/15403398881743.8168ae00.jpg" alt></p><p><img src="/udacity-self-driving-car-notes/assets/img/15403401346640.7659d62a.jpg" alt></p><div class="tip custom-block"><p class="custom-block-title">扩展阅读</p><ol><li><a href="https://zh.wikipedia.org/wiki/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2" target="_blank" rel="noopener noreferrer">卡尔曼滤波</a></li><li><a href="https://www.cnblogs.com/Jessica-jie/p/6893473.html" target="_blank" rel="noopener noreferrer">kalman滤波（一）---对各参数的理解</a></li><li><a href="http://www.ilectureonline.com/lectures/subject/SPECIAL%20TOPICS/26/190" target="_blank" rel="noopener noreferrer">Lectures in The Kalman Filter</a></li></ol></div></div><div class="content edit-link"><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/edit/master/package/posts/self-driving-car/kalman.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/udacity-self-driving-car-notes/posts/self-driving-car/transferlearning.html" class="prev">
          迁移学习
        </a></span><span class="next"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/extended_kalman.html">
          扩展卡尔曼滤波器
        </a> →
      </span></p></div></div></div></div>
    <script src="/udacity-self-driving-car-notes/assets/js/8.d5dc0d43.js" defer></script><script src="/udacity-self-driving-car-notes/assets/js/app.9d1536ba.js" defer></script>
  </body>
</html>
