<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能驾驶学习笔记 | 高级计算机视觉</title>
    <meta name="description" content="by Lingfeng Ai">
    <link rel="icon" href="/udacity-self-driving-car-notes/logo.png">
  <link rel="manifest" href="/udacity-self-driving-car-notes/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/udacity-self-driving-car-notes/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/udacity-self-driving-car-notes/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/udacity-self-driving-car-notes/assets/css/39.styles.324ff695.css" as="style"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/app.9d1536ba.js" as="script"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/16.66a78c36.js" as="script"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/0.5a0d0a03.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/1.3c16db86.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/2.82869c57.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/3.abce6f6e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/4.d292cf16.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/5.ea8d1b25.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/6.075c246a.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/7.b08b1660.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/8.d5dc0d43.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/9.5b0c06bc.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/10.0b8a6888.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/11.42ab3273.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/12.e2c4661c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/13.879fc8b7.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/14.d39d5a97.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/15.ac893474.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/17.d2854f61.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/18.2e384199.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/19.b2ee5ebf.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/20.07070574.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/21.843b60f6.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/22.41e82bd8.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/23.6923b46f.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/24.c0dac1ae.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/25.797e5ac2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/26.0d99f9e6.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/27.955632c7.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/28.77e6b09c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/29.4840cba9.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/30.4cceab91.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/31.2c3721c9.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/32.e332d881.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/33.d1f45cc8.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/34.a320b8af.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/35.d69a41d9.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/36.79745f71.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/37.e340c11e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/38.a581b2e6.js">
    <link rel="stylesheet" href="/udacity-self-driving-car-notes/assets/css/39.styles.324ff695.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/udacity-self-driving-car-notes/" class="home-link router-link-active"><!----><span class="site-name">
      智能驾驶学习笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>1. 计算机视觉基础</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/find-lane-line.html" class="sidebar-link">车道线检测</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2. 计算机视觉进阶</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>3. 深度学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>4. tersorflow</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>5. 卷积神经网络</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>6. 基于LeNet的信号灯分类</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>7. Keras</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>8. 迁移学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>9. 卡尔曼滤波</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h2 id="project-steps"><a href="#project-steps" aria-hidden="true" class="header-anchor">#</a> Project Steps</h2><ol><li>Camera calibration</li><li>Distortion correction</li><li>Color/gradient threshold</li><li>Perspective transform</li><li>Detect lane lines</li><li>Determine the lane curvature</li></ol><h2 id="locate-the-lane-lines"><a href="#locate-the-lane-lines" aria-hidden="true" class="header-anchor">#</a> Locate the Lane Lines</h2><p>**注意：**构造视图变化的点对最终结果有决定性影响，表现在两点：</p><ol><li>src和dst的点顺序必须一致，从左上的原点开始，顺时针</li><li>结构必须正确</li></ol><pre class="language-python"><code>corners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">575</span><span class="token punctuation">,</span> <span class="token number">475</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">715</span><span class="token punctuation">,</span> <span class="token number">475</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1100</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">205</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
src <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>corners<span class="token punctuation">,</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
</code></pre><p>通过一张标准的图像进行选点，只要src的梯形正好覆盖了两条车道线，不论选择的dst矩形如何，车道线一定也是被矩形覆盖的，因为可以看作是同时进行的变换。但是dst矩形的大小会导致车道线的大小产生缩放，此项目中我们暂时不关心</p><pre class="language-python"><code>    corners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">581</span><span class="token punctuation">,</span> <span class="token number">477</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">705</span><span class="token punctuation">,</span> <span class="token number">477</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1110</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">205</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    src <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>corners<span class="token punctuation">,</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    dst <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">800</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">400</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
</code></pre><p><img src="media/15358532090162.jpg" alt></p><p>应用到其他图像
<img src="media/15358531378690.jpg" alt></p><h3 id="line-finding-method-peaks-in-a-histogram"><a href="#line-finding-method-peaks-in-a-histogram" aria-hidden="true" class="header-anchor">#</a> Line Finding Method: Peaks in a Histogram</h3><pre class="language-python"><code>

<span class="token keyword">def</span> <span class="token function">hist</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># TO-DO: Grab only the bottom half of the image</span>
    <span class="token comment"># Lane lines are likely to be mostly vertical nearest to the car</span>
    shape <span class="token operator">=</span> img<span class="token punctuation">.</span>shape
    bottom_half <span class="token operator">=</span> img<span class="token punctuation">[</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token comment">#plt.figure(figsize=(24,9))</span>
    <span class="token comment">#plt.imshow(bottom_half,cmap=&quot;gray&quot;)</span>
    <span class="token comment"># TO-DO: Sum across image pixels vertically - make sure to set `axis`</span>
    <span class="token comment"># i.e. the highest areas of vertical lines should be larger values</span>
    histogram <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>bottom_half<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> histogram

<span class="token comment"># Create histogram of image binary activations</span>
histogram <span class="token operator">=</span> hist<span class="token punctuation">(</span>warped<span class="token punctuation">)</span>

<span class="token comment"># Visualize the resulting histogram</span>
f<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ax1<span class="token punctuation">,</span> ax2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>

ax1<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>histogram<span class="token punctuation">,</span><span class="token string">'b-'</span><span class="token punctuation">,</span>lw<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
ax2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>warped<span class="token punctuation">,</span>cmap<span class="token operator">=</span><span class="token string">&quot;gray&quot;</span><span class="token punctuation">)</span>
</code></pre><p><img src="media/15358546108303.jpg" alt></p><p><img src="media/15358544388268.jpg" alt></p><h3 id="line-finding-method-sliding-windows"><a href="#line-finding-method-sliding-windows" aria-hidden="true" class="header-anchor">#</a> Line Finding Method: Sliding Windows</h3><h3 id><a href="#" aria-hidden="true" class="header-anchor">#</a></h3><p><a href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.nonzero.html" target="_blank" rel="noopener noreferrer">https://docs.scipy.org/doc/numpy/reference/generated/numpy.nonzero.html</a>
nonzero 返回的是所有非0元素的索引，分别是x和y各一个数组</p><ol><li>绘制直方图
<ol><li>利用直方图终点确定左右两侧</li><li>左右两侧分别选取最大值，设置sliding window的起始位置</li></ol></li><li>获取输入图像中所有非零点x坐标和y坐标</li><li>遍历所有的window索引（window的个数说设定好的，相当于分辨率）
<ol><li>对于所有非零像素，判断其x，y坐标是否属于该window</li><li>如果属于该window，加入列表，如果累积超过了设定的阈值minpix，则将window的终点移动到所有这些点x坐标的平均值处，作为下一个window的位置</li><li>绘制window</li></ol></li><li>上述步骤执行完毕后，得到了所有满足条件点的坐标，然后对其进行多项式拟合</li></ol><p><img src="media/15358958699006.jpg" alt></p><p><img src="media/15358959456110.jpg" alt></p><p><img src="media/15358959539486.jpg" alt></p><h3 id="line-finding-method-skip-sliding-windows"><a href="#line-finding-method-skip-sliding-windows" aria-hidden="true" class="header-anchor">#</a> Line Finding Method: Skip Sliding Windows</h3><p>对每一帧都是用sliding window的话，效率是比较低的，所以我们先对第一帧使用。</p><p><a href="https://blog.csdn.net/csdn15698845876/article/details/73380803" target="_blank" rel="noopener noreferrer">Numpy中stack()，hstack()，vstack()函数详解</a></p><h4 id="flipud"><a href="#flipud" aria-hidden="true" class="header-anchor">#</a> flipud</h4></div><div class="content edit-link"><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/edit/master/package/posts/self-driving-car/adv_cv.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div></div></div>
    <script src="/udacity-self-driving-car-notes/assets/js/16.66a78c36.js" defer></script><script src="/udacity-self-driving-car-notes/assets/js/app.9d1536ba.js" defer></script>
  </body>
</html>
