<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能驾驶学习笔记 | 项目2——高级车道线检测</title>
    <meta name="description" content="by Lingfeng Ai">
    <link rel="icon" href="/udacity-self-driving-car-notes/logo.png">
  <link rel="manifest" href="/udacity-self-driving-car-notes/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/udacity-self-driving-car-notes/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/udacity-self-driving-car-notes/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/udacity-self-driving-car-notes/assets/css/35.styles.5c875455.css" as="style"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/app.adcd6e18.js" as="script"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/3.5d010771.js" as="script"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/0.928987af.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/1.af6be042.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/2.997285ba.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/4.b24f24bb.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/5.51bbd3c0.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/6.b8471489.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/7.08371cf4.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/8.72cff05c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/9.ff02842e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/10.45937176.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/11.22a9de93.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/12.992b98d1.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/13.e2e7ee02.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/14.23a306a2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/15.54054ca0.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/16.560b4f9a.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/17.2a7b59a8.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/18.bb3cfe6b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/19.6178034f.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/20.07f5c0cf.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/21.230ba7e5.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/22.11df9430.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/23.2450de7b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/24.b2d559fd.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/25.abb9c08e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/26.6864309f.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/27.d772ed58.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/28.1be3b4bf.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/29.e80e6a50.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/30.aa9f0165.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/31.defb0963.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/32.15035b78.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/33.70438b13.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/34.25bb1e1d.js">
    <link rel="stylesheet" href="/udacity-self-driving-car-notes/assets/css/35.styles.5c875455.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/udacity-self-driving-car-notes/" class="home-link router-link-active"><!----><span class="site-name">
      智能驾驶学习笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>1. 计算机视觉基础</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>2. 计算机视觉进阶</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/camera.html" class="sidebar-link">相机标定</a></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/colorspace.html" class="sidebar-link">梯度和色彩空间</a></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/perspective.html" class="sidebar-link">视角变换</a></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html" class="active sidebar-link">项目2——高级车道线检测</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#advanced-lane-finding-project" class="sidebar-link">**Advanced Lane Finding Project**</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#here-i-will-consider-the-rubric-points-individually-and-describe-how-i-addressed-each-point-in-my-implementation" class="sidebar-link">Here I will consider the rubric points individually and describe how I addressed each point in my implementation.</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#the-implementation-can-be-found-here" class="sidebar-link">the implementation can be found [here](./main.ipynb)</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#camera-calibration" class="sidebar-link">Camera Calibration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#_1-briefly-state-how-you-computed-the-camera-matrix-and-distortion-coefficients-provide-an-example-of-a-distortion-corrected-calibration-image" class="sidebar-link">1. Briefly state how you computed the camera matrix and distortion coefficients. Provide an example of a distortion-corrected calibration image.</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#pipeline-single-images" class="sidebar-link">Pipeline (single images)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#_1-provide-an-example-of-a-distortion-corrected-image" class="sidebar-link">1. Provide an example of a distortion-corrected image.</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#_2-describe-how-and-identify-where-in-your-code-you-used-color-transforms-gradients-or-other-methods-to-create-a-thresholded-binary-image-provide-an-example-of-a-binary-image-result" class="sidebar-link">2. Describe how (and identify where in your code) you used color transforms, gradients or other methods to create a thresholded binary image.  Provide an example of a binary image result.</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#_3-describe-how-and-identify-where-in-your-code-you-performed-a-perspective-transform-and-provide-an-example-of-a-transformed-image" class="sidebar-link">3. Describe how (and identify where in your code) you performed a perspective transform and provide an example of a transformed image.</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#pipeline-video" class="sidebar-link">Pipeline (video)</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/p2.html#discussion" class="sidebar-link">Discussion</a></li></ul></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>3. 深度学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>4. tersorflow</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>5.卷积神经网络</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>6.基于LeNet的信号灯分类</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="writeup"><a href="#writeup" aria-hidden="true" class="header-anchor">#</a> Writeup</h1><h2 id="advanced-lane-finding-project"><a href="#advanced-lane-finding-project" aria-hidden="true" class="header-anchor">#</a><strong>Advanced Lane Finding Project</strong></h2><p>The goals/steps of this project are the following:</p><ul><li>Compute the camera calibration matrix and distortion coefficients given a set of chessboard images.</li><li>Apply a distortion correction to raw images.</li><li>Use color transforms, gradients, etc., to create a thresholded binary image.</li><li>Apply a perspective transform to rectify binary image (&quot;birds-eye view&quot;).</li><li>Detect lane pixels and fit to find the lane boundary.</li><li>Determine the curvature of the lane and vehicle position with respect to the center.</li><li>Warp the detected lane boundaries back onto the original image.</li><li>Output visual display of the lane boundaries and numerical estimation of lane curvature and vehicle position.</li></ul><h2 id="here-i-will-consider-the-rubric-points-individually-and-describe-how-i-addressed-each-point-in-my-implementation"><a href="#here-i-will-consider-the-rubric-points-individually-and-describe-how-i-addressed-each-point-in-my-implementation" aria-hidden="true" class="header-anchor">#</a> Here I will consider the rubric points individually and describe how I addressed each point in my implementation.</h2><hr><h3 id="the-implementation-can-be-found-here"><a href="#the-implementation-can-be-found-here" aria-hidden="true" class="header-anchor">#</a> the implementation can be found <a href="./main.ipynb">here</a></h3><h2 id="camera-calibration"><a href="#camera-calibration" aria-hidden="true" class="header-anchor">#</a> Camera Calibration</h2><h3 id="_1-briefly-state-how-you-computed-the-camera-matrix-and-distortion-coefficients-provide-an-example-of-a-distortion-corrected-calibration-image"><a href="#_1-briefly-state-how-you-computed-the-camera-matrix-and-distortion-coefficients-provide-an-example-of-a-distortion-corrected-calibration-image" aria-hidden="true" class="header-anchor">#</a> 1. Briefly state how you computed the camera matrix and distortion coefficients. Provide an example of a distortion-corrected calibration image.</h3><h4 id="_1-prepared-the-object-points-and-image-points"><a href="#_1-prepared-the-object-points-and-image-points" aria-hidden="true" class="header-anchor">#</a> 1. Prepared the <strong>object points</strong> and <strong>image points</strong></h4><p>The <strong>object points</strong> is the (x,y,z) corrdinates of the chessboard corners in the real world.By assuming the chessboard is fixed on the z plane(z=0).Thus the <code>objp</code> is as below:</p><pre class="language-python"><code><span class="token comment"># prepare object points, like (0,0,0), (1,0,0), (2,0,0) ....,(6,5,0)</span>
objp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
objp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><p>The <strong>image points</strong> is the corners we detected in the chessboard image as below:</p><pre class="language-python"><code>ret<span class="token punctuation">,</span> corners <span class="token operator">=</span> cv2<span class="token punctuation">.</span>findChessboardCorners<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> ret <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            objpoints<span class="token punctuation">.</span>append<span class="token punctuation">(</span>objp<span class="token punctuation">)</span>
            imgpoints<span class="token punctuation">.</span>append<span class="token punctuation">(</span>corners<span class="token punctuation">)</span>
            <span class="token comment"># Draw and display the corners</span>
            annotated_images<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>drawChessboardCorners<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> corners<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><h4 id="_2-using-those-two-points-sets-to-calibrate-camera"><a href="#_2-using-those-two-points-sets-to-calibrate-camera" aria-hidden="true" class="header-anchor">#</a> 2. Using those two points sets to calibrate camera:</h4><pre class="language-python"><code>ret<span class="token punctuation">,</span> mtx<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> rvecs<span class="token punctuation">,</span> tvecs <span class="token operator">=</span> cv2<span class="token punctuation">.</span>calibrateCamera<span class="token punctuation">(</span>objpoints<span class="token punctuation">,</span> imgpoints<span class="token punctuation">,</span> gray<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/draw_corners.b0a2c351.jpg" alt="draw_corners"></p><h4 id="_3-using-the-cv2-calibratecamera-return-to-undistort-the-image"><a href="#_3-using-the-cv2-calibratecamera-return-to-undistort-the-image" aria-hidden="true" class="header-anchor">#</a> 3. Using the <code>cv2.calibrateCamera</code> return to <code>undistort()</code> the image</h4><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">get_undistort_img</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>mtx<span class="token punctuation">,</span>dist<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> cv2<span class="token punctuation">.</span>undistort<span class="token punctuation">(</span>img<span class="token punctuation">,</span> mtx<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> mtx<span class="token punctuation">)</span>
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/Undistort_calibration15.1ffaebbb.jpg" alt="Undistort_calibration15"><img src="/udacity-self-driving-car-notes/assets/img/Undistort_calibration5.b74e7d37.jpg" alt="Undistort_calibration5"></p><h4 id="_4-then-we-apply-the-measurement-to-our-test-images"><a href="#_4-then-we-apply-the-measurement-to-our-test-images" aria-hidden="true" class="header-anchor">#</a> 4. Then we apply the measurement to our test images</h4><p>here I will show you some of the iamges
<img src="/udacity-self-driving-car-notes/assets/img/Undistort_straight_lines1.0bf0c5a3.jpg" alt="Undistort_straight_lines1"><img src="/udacity-self-driving-car-notes/assets/img/Undistort_test3.38da0858.jpg" alt="Undistort_test3"><img src="/udacity-self-driving-car-notes/assets/img/Undistort_test5.b9c9dd77.jpg" alt="Undistort_test5"></p><h2 id="pipeline-single-images"><a href="#pipeline-single-images" aria-hidden="true" class="header-anchor">#</a> Pipeline (single images)</h2><h3 id="_1-provide-an-example-of-a-distortion-corrected-image"><a href="#_1-provide-an-example-of-a-distortion-corrected-image" aria-hidden="true" class="header-anchor">#</a> 1. Provide an example of a distortion-corrected image.</h3><p>To demonstrate this step, I will describe how I apply the distortion correction to one of the test images like this one:./imgs
<img src="/udacity-self-driving-car-notes/assets/img/Undistort_straight_lines1.0bf0c5a3.jpg" alt="Undistort_straight_lines1"></p><h3 id="_2-describe-how-and-identify-where-in-your-code-you-used-color-transforms-gradients-or-other-methods-to-create-a-thresholded-binary-image-provide-an-example-of-a-binary-image-result"><a href="#_2-describe-how-and-identify-where-in-your-code-you-used-color-transforms-gradients-or-other-methods-to-create-a-thresholded-binary-image-provide-an-example-of-a-binary-image-result" aria-hidden="true" class="header-anchor">#</a> 2. Describe how (and identify where in your code) you used color transforms, gradients or other methods to create a thresholded binary image.  Provide an example of a binary image result.</h3><p>I used a combination of color and gradient thresholds to generate a binary image.  Here's an example of my output for this step.  (note: this is not actually from one of the test images)</p><p><img src="/udacity-self-driving-car-notes/assets/img/Undistort_test1-2.ca77aee1.jpg" alt="Undistort_test1"></p><h4 id="_1-we-use-sobel-operator-the-take-the-gradient-thresholds"><a href="#_1-we-use-sobel-operator-the-take-the-gradient-thresholds" aria-hidden="true" class="header-anchor">#</a> 1. We use sobel operator the take the gradient thresholds</h4><p>Calculate the derivative in the xx direction (the 1, 0 at the end denotes xx direction):<br><code>sobelx = cv2.Sobel(gray, cv2.CV_64F, 1, 0)</code><br><img src="/udacity-self-driving-car-notes/assets/img/grad_binary_x-1.acdba664.png" alt="grad_binary_x">
Calculate the derivative in the yy direction (the 0, 1 at the end denotes yy direction):
<code>sobely = cv2.Sobel(gray, cv2.CV_64F, 0, 1)</code><br>
Taking the gradient in the xx direction emphasizes edges closer to vertical. Alternatively, taking the gradient in the yy direction emphasizes edges closer to horizontal.
<img src="/udacity-self-driving-car-notes/assets/img/grad_binary_y-1.1cb6e548.png" alt="grad_binary_y">
The magnitude, or absolute value, of the gradient is just the square root of the squares of the individual x and y gradients. For a gradient in both the xx and yy directions, the magnitude is the square root of the sum of the squares.</p><pre class="language-python"><code>sobel_xy <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>sobel_x<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> sobel_y<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
scaled_xy <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token number">255</span> <span class="token operator">*</span> sobel_xy <span class="token operator">/</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>sobel_xy<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/mag_binary_xy-1.ccfb8c15.png" alt="mag_binary_xy"></p><p>In the case of lane lines, we're interested only in edges of a particular orientation. So now we will explore the direction, or orientation, of the gradient.</p><pre class="language-python"><code>sx_abs <span class="token operator">=</span> np<span class="token punctuation">.</span>absolute<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CV_64F<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span>kernel_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
sy_abs <span class="token operator">=</span> np<span class="token punctuation">.</span>absolute<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CV_64F<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span>kernel_size<span class="token punctuation">)</span><span class="token punctuation">)</span>    
dir_sxy <span class="token operator">=</span> np<span class="token punctuation">.</span>arctan2<span class="token punctuation">(</span>sx_abs<span class="token punctuation">,</span> sy_abs<span class="token punctuation">)</span>
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/dir_sobel_xy-1.ce4e9c55.png" alt="dir_sobel_xy"></p><p>the threshold we use is as below:</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">lower</th><th style="text-align:center">upper</th></tr></thead><tbody><tr><td style="text-align:center">sobel-x</td><td style="text-align:center">20</td><td style="text-align:center">120</td></tr><tr><td style="text-align:center">sobel-y</td><td style="text-align:center">20</td><td style="text-align:center">120</td></tr><tr><td style="text-align:center">Magnitude of the Gradient</td><td style="text-align:center">80</td><td style="text-align:center">200</td></tr><tr><td style="text-align:center">Direction of the Gradient</td><td style="text-align:center">np.pi/4</td><td style="text-align:center">np.pi/2</td></tr></tbody></table><p>now,we will combine them to get a batter result, since the sobel-x will detect line close vertical,we'll keep it all</p><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">combined_sobels</span><span class="token punctuation">(</span>sx_binary<span class="token punctuation">,</span> sy_binary<span class="token punctuation">,</span> sxy_magnitude_binary<span class="token punctuation">,</span>sxy_direction_binary<span class="token punctuation">)</span><span class="token punctuation">:</span>    
    combined <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>sxy_direction_binary<span class="token punctuation">)</span>
    combined<span class="token punctuation">[</span><span class="token punctuation">(</span>sx_binary <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>sy_binary <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>sxy_magnitude_binary <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>sxy_direction_binary <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> combined
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/combine.e2ee0350.jpg" alt="combine"></p><h4 id="_2-color-thresholding"><a href="#_2-color-thresholding" aria-hidden="true" class="header-anchor">#</a> 2. Color Thresholding</h4><pre class="language-python"><code>yellow_binary<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h <span class="token operator">&gt;=</span> <span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>h <span class="token operator">&lt;=</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>l <span class="token operator">&gt;=</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;=</span> <span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">&gt;=</span> <span class="token number">115</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>s <span class="token operator">&lt;=</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
white_binary <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>h<span class="token punctuation">)</span>
white_binary<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>h <span class="token operator">&lt;=</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>l<span class="token operator">&gt;=</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;=</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>s<span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>s <span class="token operator">&lt;=</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/ywundistort_straight_lines2.jpg.008513a7.jpg" alt="ywundistort_straight_lines2.jpg"><img src="/udacity-self-driving-car-notes/assets/img/ywundistort_test1.jpg.34c167d2.jpg" alt="ywundistort_test1.jpg"><img src="/udacity-self-driving-car-notes/assets/img/ywundistort_test2.jpg.9cb9eb0a.jpg" alt="ywundistort_test2.jpg"><img src="/udacity-self-driving-car-notes/assets/img/ywundistort_test4.jpg.1a5fece5.jpg" alt="ywundistort_test4.jpg"></p><h4 id="_3-combine-the-gradient-and-color-threshed"><a href="#_3-combine-the-gradient-and-color-threshed" aria-hidden="true" class="header-anchor">#</a> 3. Combine the gradient and color threshed</h4><pre class="language-python"><code>color_binary_combined <span class="token operator">=</span> np<span class="token punctuation">.</span>dstack<span class="token punctuation">(</span><span class="token punctuation">(</span>combined_grad<span class="token punctuation">,</span> combined_yellow_white<span class="token punctuation">,</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>combined_grad<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span>
combined_binary <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>gray<span class="token punctuation">)</span>
combined_binary<span class="token punctuation">[</span><span class="token punctuation">(</span>combined_grad <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token punctuation">(</span>combined_yellow_white <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><p><img src="/udacity-self-driving-car-notes/assets/img/combine_grad_color.caf8a6b6.jpg" alt="combine_grad_colo">
the red line is detected by gradient and the green is detected by color</p><h3 id="_3-describe-how-and-identify-where-in-your-code-you-performed-a-perspective-transform-and-provide-an-example-of-a-transformed-image"><a href="#_3-describe-how-and-identify-where-in-your-code-you-performed-a-perspective-transform-and-provide-an-example-of-a-transformed-image" aria-hidden="true" class="header-anchor">#</a> 3. Describe how (and identify where in your code) you performed a perspective transform and provide an example of a transformed image.</h3><p>The code for my perspective transform includes a function called <code>warper()</code>, which appears in lines 1 through 8 in the file <code>example.py</code> (./imgs/examples/example.py) (or, for example, in the 3rd code cell of the IPython notebook).  The <code>warper()</code> function takes as inputs an image (<code>img</code>), as well as source (<code>src</code>) and destination (<code>dst</code>) points.  I chose the hardcode the source and destination points in the following manner:</p><pre class="language-python"><code>src <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">55</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">/</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
dst <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">(</span>img_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><p>note:the points should be clock-wise and start from the left-bottom, the <strong>src</strong> and the <strong>des</strong> should have the same orders otherwise the result picture will be upside down or twisted.</p><p><img src="/udacity-self-driving-car-notes/assets/img/bird_view_trans.d087fc04.png" alt="bird_view_trans"><img src="/udacity-self-driving-car-notes/assets/img/bird_undistort_straight_lines2.jpg.aa7e91c8.jpg" alt="bird_undistort_straight_lines2.jpg"><img src="/udacity-self-driving-car-notes/assets/img/bird_undistort_test3.jpg.715647d3.jpg" alt="bird_undistort_test3.jpg"></p><h4 id="_4-describe-how-and-identify-where-in-your-code-you-identified-lane-line-pixels-and-fit-their-positions-with-a-polynomial"><a href="#_4-describe-how-and-identify-where-in-your-code-you-identified-lane-line-pixels-and-fit-their-positions-with-a-polynomial" aria-hidden="true" class="header-anchor">#</a> 4. Describe how (and identify where in your code) you identified lane-line pixels and fit their positions with a polynomial?</h4><p>I plot the histogram of the bird-view image, then find the peek to decide the left base and right base of the lane lines</p><p><img src="/udacity-self-driving-car-notes/assets/img/15369332223515.c2a99a32.jpg" alt><img src="/udacity-self-driving-car-notes/assets/img/findline_undistort_straight_lines2.jpg.f0b650cf.jpg" alt="findline_undistort_straight_lines2.jpg"><img src="/udacity-self-driving-car-notes/assets/img/findline_undistort_test3.jpg.26cd5301.jpg" alt="findline_undistort_test3.jpg"></p><p>then we use <strong>slide window</strong> to find the lane pixels:</p><ol><li>define 10 windows, the window's height is the height of image divide num of windows</li><li>loop through those windows
<ul><li>Identify window boundaries in x and y (and right and left)</li><li>Identify the nonzero pixels in the image and their index</li><li>Identify the nonzero pixels in x and y within the window and append its index to each line</li><li>If we found &gt; minpix pixels, recenter next window, the new center is the mean of pixels' co</li></ul></li><li>Extract left and right line pixel positions</li></ol><p><img src="/udacity-self-driving-car-notes/assets/img/find_lane_pixels.b7f26dad.jpg" alt="find_lane_pixels"></p><p>At last, we need to use polyfit function in numpy to find a line that is best fit the pixels of each line.</p><pre class="language-python"><code><span class="token comment"># Find our lane pixels first</span>
leftx<span class="token punctuation">,</span> lefty<span class="token punctuation">,</span> rightx<span class="token punctuation">,</span> righty<span class="token punctuation">,</span> out_img <span class="token operator">=</span> find_lane_pixels<span class="token punctuation">(</span>binary_warped<span class="token punctuation">)</span>
left_fit <span class="token operator">=</span> np<span class="token punctuation">.</span>polyfit<span class="token punctuation">(</span>lefty<span class="token punctuation">,</span> leftx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
right_fit <span class="token operator">=</span> np<span class="token punctuation">.</span>polyfit<span class="token punctuation">(</span>righty<span class="token punctuation">,</span> rightx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><p>we can use list comprehension to make (x,y)</p><pre class="language-python"><code>pts_left<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>left_fitx<span class="token punctuation">,</span>ploty<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pts_right<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span>y<span class="token punctuation">]</span> <span class="token keyword">for</span> x<span class="token punctuation">,</span>y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>right_fitx<span class="token punctuation">,</span>ploty<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><p>but we can still use <code>np.vstack</code> to make (x,y)</p><pre class="language-text"><code>left_line = np.array([np.transpose(np.vstack([left_fitx, ploty]))])
</code></pre><p>let me show you the result:
<img src="/udacity-self-driving-car-notes/assets/img/findpix_undistort_straight_lines1.jpg.63ee3a83.jpg" alt="findpix_undistort_straight_lines1.jpg"><img src="/udacity-self-driving-car-notes/assets/img/findpix_undistort_test3.jpg.22c59dce.jpg" alt="findpix_undistort_test3.jpg"><img src="/udacity-self-driving-car-notes/assets/img/findpix_undistort_test4.jpg.112537ab.jpg" alt="findpix_undistort_test4.jpg"></p><h4 id="_5-describe-how-and-identify-where-in-your-code-you-calculated-the-radius-of-curvature-of-the-lane-and-the-position-of-the-vehicle-with-respect-to-the-center"><a href="#_5-describe-how-and-identify-where-in-your-code-you-calculated-the-radius-of-curvature-of-the-lane-and-the-position-of-the-vehicle-with-respect-to-the-center" aria-hidden="true" class="header-anchor">#</a> 5. Describe how (and identify where in your code) you calculated the radius of curvature of the lane and the position of the vehicle with respect to the center.</h4><p>First, we define the transformation rules to trans image pixels to real world length</p><pre class="language-python"><code>ym_per_pix <span class="token operator">=</span> <span class="token number">30</span><span class="token operator">/</span><span class="token number">720</span> <span class="token comment"># meters per pixel in y dimension</span>
xm_per_pix <span class="token operator">=</span> <span class="token number">3.7</span><span class="token operator">/</span><span class="token number">700</span> <span class="token comment"># </span>
lane_center_px_psp <span class="token operator">=</span> <span class="token number">600</span>
</code></pre><p>then we calculate  the radius of curvature of the lane</p><pre class="language-python"><code>left_curverad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>left_fit_cr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>y_eval<span class="token operator">*</span>ym_per_pix <span class="token operator">+</span> left_fit_cr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>absolute<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>left_fit_cr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
right_curverad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>right_fit_cr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">*</span>y_eval<span class="token operator">*</span>ym_per_pix <span class="token operator">+</span> right_fit_cr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>absolute<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>right_fit_cr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
center_offset <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>left_fit<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> y_eval<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> left_fit<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> y_eval <span class="token operator">+</span> left_fit<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> 
                   <span class="token punctuation">(</span>right_fit<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> y_eval<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> right_fit<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> y_eval <span class="token operator">+</span> right_fit<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> lane_center_px_psp

center_offset <span class="token operator">=</span> center_offset<span class="token operator">*</span>xm_per_pix
</code></pre><p>to see it clearly, I combined the image as below:
<img src="/udacity-self-driving-car-notes/assets/img/calculate_cr_undistort_straight_lines1.jpg.2f5bcd93.jpg" alt="calculate_cr_undistort_straight_lines1.jpg"><img src="/udacity-self-driving-car-notes/assets/img/calculate_cr_undistort_test3.jpg.890e0d9f.jpg" alt="calculate_cr_undistort_test3.jpg"><img src="/udacity-self-driving-car-notes/assets/img/calculate_cr_undistort_test4.jpg.edbac3fe.jpg" alt="calculate_cr_undistort_test4.jpg"></p><h4 id="_6-provide-an-example-image-of-your-result-plotted-back-down-onto-the-road-such-that-the-lane-area-is-identified-clearly"><a href="#_6-provide-an-example-image-of-your-result-plotted-back-down-onto-the-road-such-that-the-lane-area-is-identified-clearly" aria-hidden="true" class="header-anchor">#</a> 6. Provide an example image of your result plotted back down onto the road such that the lane area is identified clearly.</h4><p><img src="/udacity-self-driving-car-notes/assets/img/15369360065213.5a80d2d9.jpg" alt></p><hr><h3 id="pipeline-video"><a href="#pipeline-video" aria-hidden="true" class="header-anchor">#</a> Pipeline (video)</h3><h4 id="_1-provide-a-link-to-your-final-video-output-your-pipeline-should-perform-reasonably-well-on-the-entire-project-video-wobbly-lines-are-ok-but-no-catastrophic-failures-that-would-cause-the-car-to-drive-off-the-road"><a href="#_1-provide-a-link-to-your-final-video-output-your-pipeline-should-perform-reasonably-well-on-the-entire-project-video-wobbly-lines-are-ok-but-no-catastrophic-failures-that-would-cause-the-car-to-drive-off-the-road" aria-hidden="true" class="header-anchor">#</a> 1. Provide a link to your final video output.  Your pipeline should perform reasonably well on the entire project video (wobbly lines are ok but no catastrophic failures that would cause the car to drive off the road!).</h4><p>Here's a <a href="https://www.youtube.com/watch?v=AoPu7QEHCx8&feature=youtu.be" target="_blank" rel="noopener noreferrer">link to my video result</a></p><p>or <a href="./test_output/test.mp4">this one</a></p><hr><h3 id="discussion"><a href="#discussion" aria-hidden="true" class="header-anchor">#</a> Discussion</h3><h4 id="_1-briefly-discuss-any-problems-issues-you-faced-in-your-implementation-of-this-project-where-will-your-pipeline-likely-fail-what-could-you-do-to-make-it-more-robust"><a href="#_1-briefly-discuss-any-problems-issues-you-faced-in-your-implementation-of-this-project-where-will-your-pipeline-likely-fail-what-could-you-do-to-make-it-more-robust" aria-hidden="true" class="header-anchor">#</a> 1. Briefly discuss any problems/issues you faced in your implementation of this project.  Where will your pipeline likely fail?  What could you do to make it more robust?</h4><h4 id="problems"><a href="#problems" aria-hidden="true" class="header-anchor">#</a> Problems</h4><ul><li>it's hard to find the best threshold</li><li>the first time when I make perspectve transform , the order of src point and dest is not same, so the bird-view picture is actually up-side down but its hard to notice and it can infulence the result</li></ul><h4 id="what-could-be-improved"><a href="#what-could-be-improved" aria-hidden="true" class="header-anchor">#</a> What Could Be Improved</h4><ul><li>the algo that I used will failed on challenge_video.mp4,still have no idea how to fix it yet</li><li>I should explore more color space ,such as LAB</li><li>I think I should use prior infomation of the lane lines as I did in projet one</li></ul></div><div class="content edit-link"><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/edit/master/package/posts/self-driving-car/p2.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/udacity-self-driving-car-notes/posts/self-driving-car/perspective.html" class="prev">
          视角变换
        </a></span><span class="next"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/deeplearning.html">
          神经网络
        </a> →
      </span></p></div></div></div></div>
    <script src="/udacity-self-driving-car-notes/assets/js/3.5d010771.js" defer></script><script src="/udacity-self-driving-car-notes/assets/js/app.adcd6e18.js" defer></script>
  </body>
</html>
