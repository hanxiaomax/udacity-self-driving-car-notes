<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>智能驾驶学习笔记 | 卡尔曼滤波</title>
    <meta name="description" content="by Lingfeng Ai">
    <link rel="icon" href="/udacity-self-driving-car-notes/logo.png">
  <link rel="manifest" href="/udacity-self-driving-car-notes/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/udacity-self-driving-car-notes/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/udacity-self-driving-car-notes/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/udacity-self-driving-car-notes/assets/css/43.styles.e1b6c1ba.css" as="style"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/app.2326a8fb.js" as="script"><link rel="preload" href="/udacity-self-driving-car-notes/assets/js/10.6ef9a101.js" as="script"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/0.dc01609a.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/1.0a12ce35.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/2.488ddb3b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/3.2659f101.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/4.d58f8616.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/5.be953523.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/6.898b9049.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/7.81742641.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/8.a26495e0.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/9.0fd1277b.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/11.386bf941.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/12.9f9cc0f2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/13.9c645792.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/14.f9df8329.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/15.76afe33a.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/16.5f6b49e2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/17.dac89fea.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/18.ff7189a0.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/19.1e32b45a.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/20.cc1e056d.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/21.d480f3cf.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/22.642f1530.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/23.0e2afe32.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/24.9a06c998.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/25.bf35f4be.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/26.937edf0d.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/27.26e058dc.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/28.18e050b7.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/29.a82ea24c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/30.f545abe3.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/31.e4679d94.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/32.d990eeb0.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/33.a8cab977.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/34.d664f8c2.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/35.4fc2776c.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/36.1a7ed446.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/37.0d49d917.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/38.b543f965.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/39.a17f2273.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/40.bddf218f.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/41.395dcf5e.js"><link rel="prefetch" href="/udacity-self-driving-car-notes/assets/js/42.bf4c60cd.js">
    <link rel="stylesheet" href="/udacity-self-driving-car-notes/assets/css/43.styles.e1b6c1ba.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/udacity-self-driving-car-notes/" class="home-link router-link-active"><!----><span class="site-name">
      智能驾驶学习笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/udacity-self-driving-car-notes/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">笔记</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/intro-self-driving-car/" class="nav-link">无人驾驶入门</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/self-driving-car/" class="nav-link router-link-active">无人驾驶工程师</a></li><li class="dropdown-item"><!----><a href="/udacity-self-driving-car-notes/posts/others/" class="nav-link">未归类</a></li></ul></div></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/res/" class="nav-link">资源</a></div><div class="nav-item"><a href="/udacity-self-driving-car-notes/contact/" class="nav-link">联系</a></div><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>1. 计算机视觉基础</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>2. 计算机视觉进阶</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>3. 深度学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>4. tersorflow</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>5. 卷积神经网络</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>6. 基于LeNet的信号灯分类</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>7. Keras</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>8. 迁移学习</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>9. 卡尔曼滤波</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html" class="active sidebar-link">卡尔曼滤波</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_1-更新循环和移动循环" class="sidebar-link">1. 更新循环和移动循环</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_2-测量更新" class="sidebar-link">2. 测量更新</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#数学原理" class="sidebar-link">数学原理</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#代码" class="sidebar-link">代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_3-移动更新（预测过程）" class="sidebar-link">3. 移动更新（预测过程）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#数学原理-2" class="sidebar-link">数学原理</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#代码-2" class="sidebar-link">代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_4-一维卡尔曼滤波代码" class="sidebar-link">4. 一维卡尔曼滤波代码</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_5-多维高斯分布" class="sidebar-link">5. 多维高斯分布</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_6-基于多维高斯函数的预测" class="sidebar-link">6. 基于多维高斯函数的预测</a></li><li class="sidebar-sub-header"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman.html#_7-设计卡尔曼滤波器" class="sidebar-link">7. 设计卡尔曼滤波器</a></li></ul></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman-topic.html" class="sidebar-link">卡尔曼滤波-理论专题</a></li><li><a href="/udacity-self-driving-car-notes/posts/self-driving-car/extended_kalman.html" class="sidebar-link">扩展卡尔曼滤波器</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="卡尔曼滤波"><a href="#卡尔曼滤波" aria-hidden="true" class="header-anchor">#</a> 卡尔曼滤波</h1><h2 id="_1-更新循环和移动循环"><a href="#_1-更新循环和移动循环" aria-hidden="true" class="header-anchor">#</a> 1. 更新循环和移动循环</h2><ul><li>更新循环
基于乘法法则和贝叶斯定律</li><li>移动循环（预测）
基于卷积和全概率公式</li></ul><p><img src="/udacity-self-driving-car-notes/assets/img/15399554841338.52a159fb.jpg" alt></p><h2 id="_2-测量更新"><a href="#_2-测量更新" aria-hidden="true" class="header-anchor">#</a> 2. 测量更新</h2><h3 id="数学原理"><a href="#数学原理" aria-hidden="true" class="header-anchor">#</a> 数学原理</h3><p>测量的更新，基于乘法法则和贝叶斯定律。
首先我们有一个先验的测量值，然后得到一个新的测量值，两者均为正态分布。使用贝叶斯定律，我们可以得到后验概率，也就是我们更新测量后的结果</p><p><img src="/udacity-self-driving-car-notes/assets/img/15399561190760.62f938c1.jpg" alt></p><p>P(X|Z) = P(Z|X)P(X)/P(Z)
叠加之后的正态分布参数为
$
\mu^2=\frac{\mu* r^2 + \gamma*\sigma^2}{r^2+\sigma^2}
$</p><p>$
\sigma^2=\frac{1}{\frac{1}{r^2}+\frac{1}{\sigma^2}}
$</p><h3 id="代码"><a href="#代码" aria-hidden="true" class="header-anchor">#</a> 代码</h3><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> <span class="token punctuation">(</span>mean1<span class="token operator">*</span>var2<span class="token operator">+</span>mean2<span class="token operator">*</span>var1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>var1<span class="token operator">+</span>var2<span class="token punctuation">)</span>
    new_var <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>var1 <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">/</span>var2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>
</code></pre><h2 id="_3-移动更新（预测过程）"><a href="#_3-移动更新（预测过程）" aria-hidden="true" class="header-anchor">#</a> 3. 移动更新（预测过程）</h2><p><img src="/udacity-self-driving-car-notes/assets/img/15399574409127.8012fea9.jpg" alt>
预测过程基于卷积和全概率公式</p><h3 id="数学原理-2"><a href="#数学原理-2" aria-hidden="true" class="header-anchor">#</a> 数学原理</h3><p>假设我们处于一个初始位置，然后进行一次移动，移动本身是有误差的，两个事件都服从正态分布。则结果也是正态分布</p><p>$
\mu'=\mu + u
$</p><p>$
\sigma'^2 =r^2+\sigma^2
$</p><h3 id="代码-2"><a href="#代码-2" aria-hidden="true" class="header-anchor">#</a> 代码</h3><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> mean1<span class="token operator">+</span>mean2
    new_var <span class="token operator">=</span> var1<span class="token operator">+</span>var2
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>
</code></pre><h2 id="_4-一维卡尔曼滤波代码"><a href="#_4-一维卡尔曼滤波代码" aria-hidden="true" class="header-anchor">#</a> 4. 一维卡尔曼滤波代码</h2><pre class="language-python"><code><span class="token comment"># 更新函数</span>
<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>var2 <span class="token operator">*</span> mean1 <span class="token operator">+</span> var1 <span class="token operator">*</span> mean2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>var1 <span class="token operator">+</span> var2<span class="token punctuation">)</span>
    new_var <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span>var1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token operator">/</span>var2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>
<span class="token comment"># 预测函数</span>
<span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>mean1<span class="token punctuation">,</span> var1<span class="token punctuation">,</span> mean2<span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    new_mean <span class="token operator">=</span> mean1 <span class="token operator">+</span> mean2
    new_var <span class="token operator">=</span> var1 <span class="token operator">+</span> var2
    <span class="token keyword">return</span> <span class="token punctuation">[</span>new_mean<span class="token punctuation">,</span> new_var<span class="token punctuation">]</span>

measurements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment"># 测量值</span>
motion <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment"># 移动距离</span>
measurement_sig <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment"># 测量方差</span>
motion_sig <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment"># 移动方差</span>
<span class="token comment"># 初始值</span>
mu <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>
sig <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">.</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>measurements<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token operator">=</span>update<span class="token punctuation">(</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">,</span>measurements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>measurement_sig<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;update:&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 使用更新的均值和方差进行预测</span>
    <span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token operator">=</span>predict<span class="token punctuation">(</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">,</span>motion<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>motion_sig<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;pridict:&quot;</span><span class="token punctuation">,</span><span class="token punctuation">[</span>mu<span class="token punctuation">,</span>sig<span class="token punctuation">]</span><span class="token punctuation">)</span>
    
<span class="token keyword">print</span> <span class="token punctuation">[</span>mu<span class="token punctuation">,</span> sig<span class="token punctuation">]</span>

</code></pre><pre class="language-text"><code>('update:', [4.998000799680128, 3.9984006397441023])
('pridict:', [5.998000799680128, 5.998400639744102])
('update:', [5.999200191953932, 2.399744061425258])
('pridict:', [6.999200191953932, 4.399744061425258])
('update:', [6.999619127420922, 2.0951800575117594])
('pridict:', [8.999619127420921, 4.09518005751176])
('update:', [8.999811802788143, 2.0235152416216957])
('pridict:', [9.999811802788143, 4.023515241621696])
('update:', [9.999906177177365, 2.0058615808441944])
('pridict:', [10.999906177177365, 4.005861580844194])
[10.999906177177365, 4.005861580844194]
</code></pre><h2 id="_5-多维高斯分布"><a href="#_5-多维高斯分布" aria-hidden="true" class="header-anchor">#</a> 5. 多维高斯分布</h2><p>在多维高斯函数中，均值变成了一个向量，方差变成了协方差矩阵。其概率密度如下：
<img src="/udacity-self-driving-car-notes/assets/img/15401319344883.00b2f007.jpg" alt></p><p>针对二维高斯分布，协方差矩阵的对角线元素为X1与X2轴的方差，反斜对角线上的两个值为协方差，表明X1与X2的线性相关程度，（正值时：X1增大，X2也随之增大；负值时：X1增大，X2随之减小）。</p><ul><li>如果两个变量无关，则协方差矩阵为一个圆</li><li>不确定越大，圆越大</li><li>也可能在一个方向上不确定大，另一个方向不确定小，则为椭圆</li><li>如果两个维度相关，则椭圆为斜的，所谓相关，指的是我们可以以一个维度推断另一个维度。通过(X0 ,Y0)，则可以推断(X1 ,Y1)</li></ul><p><img src="/udacity-self-driving-car-notes/assets/img/15401323707395.6fea8125.jpg" alt></p><h2 id="_6-基于多维高斯函数的预测"><a href="#_6-基于多维高斯函数的预测" aria-hidden="true" class="header-anchor">#</a> 6. 基于多维高斯函数的预测</h2><p>在平面上，基于一维的高斯，我们可以预测位置，同样的，在二维的空间中，我们也可以进行预测。</p><p><img src="/udacity-self-driving-car-notes/assets/img/15401333406014.a50f748c.jpg" alt></p><p>我们可以测量X，不能测量速度，但是速度是位置的导数，所以我们说两个维度是有相关性的。在测量过程中，我们可以测得X，此时我们对速度一无所知。在预测过程中，我们可以假设一个速度，这样就能知道X在此速度下，T+1时的位置X。</p><p><img src="/udacity-self-driving-car-notes/assets/img/15401347728831.8272337e.jpg" alt></p><p><strong>上图诠释了卡尔曼滤波的核心概念。</strong></p><p>首先我们知道了X和速度V（X导数）的关系，X = Vt，也就是红色的椭圆。但是显然，斜椭圆表示两者是相关的。但是如果我们将红色椭圆投影到X或X点方向上，我们都无法进行预测，因为不论投影在哪个轴，我们都缺少另一个变量的信息。即单次观察和单次预测都无法确定观察结果。</p><p>由于红色是我们已知的规律，所以它是一种<strong>先验概率（prior）</strong>，如果我们再对X进行一次观察，得到X的<strong>条件概率(measurement)</strong>，然后依据<a href="https://baike.baidu.com/item/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%85%AC%E5%BC%8F" target="_blank" rel="noopener noreferrer">贝叶斯定律</a>将两者相乘，我们就可以得到<strong>后验概率（预测）</strong>，后验概率一定相交于在红色椭圆上，它也是一个椭圆（二维高斯），且在两个维度上可以鸽子得到一个高斯函数，预测相关维度。经过不断的测量和预测，我们注意到，红色椭圆上的黑色椭圆越来越小，表示不确定性逐渐减小（方差减小了）</p><p>这深刻的揭示了卡尔曼滤波器的原理，我们只能观察一个值的时候，就可以利用贝叶斯推断另外一个值（通过先验知识——例如物理方程）</p><p>卡尔曼滤波器可以预测一段时间后我的位置，<code>x' = x + Δtẋ'</code>，且该方程在后续的预测中可以作为约束条件。利用该约束条件，我们就可以通过x来预测速度（本身不能观察）</p><h2 id="_7-设计卡尔曼滤波器"><a href="#_7-设计卡尔曼滤波器" aria-hidden="true" class="header-anchor">#</a> 7. 设计卡尔曼滤波器</h2><p><img src="/udacity-self-driving-car-notes/assets/img/15399619340700.f982be2b.jpg" alt></p><pre class="language-python"><code><span class="token comment"># Write a function 'kalman_filter' that implements a multi-</span>
<span class="token comment"># dimensional Kalman Filter for the example given</span>
<span class="token comment">########################################</span>
<span class="token comment"># Implement the filter function below</span>

<span class="token keyword">def</span> <span class="token function">kalman_filter</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>measurements<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># measurement update</span>
        Z <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>measurements<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 测量值</span>
        y <span class="token operator">=</span> Z <span class="token operator">-</span> <span class="token punctuation">(</span>H <span class="token operator">*</span> x<span class="token punctuation">)</span> <span class="token comment"># 新的测量值矩阵</span>
        S <span class="token operator">=</span> H <span class="token operator">*</span> P <span class="token operator">*</span> H<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> R <span class="token comment">#用于计算K，卡尔曼增益的分母</span>
        K <span class="token operator">=</span>  P <span class="token operator">*</span> H<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">*</span> S<span class="token punctuation">.</span>inverse<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#卡尔曼增益</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span> K <span class="token operator">*</span> y<span class="token punctuation">)</span> <span class="token comment"># 新的估计值</span>
        P <span class="token operator">=</span> <span class="token punctuation">(</span>I <span class="token operator">-</span><span class="token punctuation">(</span>K <span class="token operator">*</span> H<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> P <span class="token comment"># 新的估计误差</span>
        
        <span class="token comment"># prediction</span>
        x <span class="token operator">=</span> <span class="token punctuation">(</span>F<span class="token operator">*</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> u <span class="token comment"># </span>
        P <span class="token operator">=</span> F <span class="token operator">*</span> P <span class="token operator">*</span> F<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span><span class="token punctuation">)</span> 
        
    <span class="token keyword">return</span> x<span class="token punctuation">,</span>P

<span class="token comment">############################################</span>
<span class="token comment">### use the code below to test your filter!</span>
<span class="token comment">############################################</span>

measurements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

x <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># initial state (location and velocity)</span>
P <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># initial uncertainty</span>
u <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># external motion</span>
F <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># next state function</span>
H <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># measurement function</span>
R <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># measurement uncertainty</span>
I <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># identity matrix</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>kalman_filter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># output should be:</span>
<span class="token comment"># x: [[3.9996664447958645], [0.9999998335552873]]</span>
<span class="token comment"># P: [[2.3318904241194827, 0.9991676099921091], [0.9991676099921067, 0.49950058263974184]]</span>

</code></pre><div class="tip custom-block"><p class="custom-block-title">扩展阅读</p><ol><li><a href="https://zh.wikipedia.org/wiki/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2" target="_blank" rel="noopener noreferrer">卡尔曼滤波</a></li><li><a href="https://www.cnblogs.com/Jessica-jie/p/6893473.html" target="_blank" rel="noopener noreferrer">kalman滤波（一）---对各参数的理解</a></li><li><a href="http://www.ilectureonline.com/lectures/subject/SPECIAL%20TOPICS/26/190" target="_blank" rel="noopener noreferrer">Lectures in The Kalman Filter</a></li></ol></div></div><div class="content edit-link"><a href="https://github.com/hanxiaomax/udacity-self-driving-car-notes/edit/master/package/posts/self-driving-car/kalman.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/udacity-self-driving-car-notes/posts/self-driving-car/transferlearning.html" class="prev">
          迁移学习
        </a></span><span class="next"><a href="/udacity-self-driving-car-notes/posts/self-driving-car/kalman-topic.html">
          卡尔曼滤波-理论专题
        </a> →
      </span></p></div></div></div></div>
    <script src="/udacity-self-driving-car-notes/assets/js/10.6ef9a101.js" defer></script><script src="/udacity-self-driving-car-notes/assets/js/app.2326a8fb.js" defer></script>
  </body>
</html>
